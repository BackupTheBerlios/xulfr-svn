

<p>Cette section décrit comment obtenir et modifier les objets sélectionnés dans un arbre.</p>

<h2>Accéder aux items sélectionnés d'un arbre</h2>

<p>
Chaque élément <code class="tag"><a href="http://xulfr.orghttp://xulfr.org/wiki/Reference/Xul/treeitem">treeitem</a></code>
d'un arbre peut être sélectionné individuellement. Si vous ajoutez l'attribut
<code class="attribut">seltype</code>
à l'arbre en lui attribuant la valeur <var>single</var> , l'utilisateur ne pourra sélectionner
qu'une ligne en même temps. Sinon, l'utilisateur pourra sélectionner plusieurs lignes
qui ne seront pas nécéssairement contigue. L'arbre met à disposition
de nombreuses fonctions qui peuvent être utilisées pour déterminer si un item est sélectionné.
</p>

<p>
D'abord, voyons comment nous pouvons déterminer qu'un item est sélectionné. Le gestionnaire d'évènement
<code class="attribut">onselect</code> peut être ajouté à l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/tree">tree</a></code>.
Lorsque l'utilisateur sélectionne un objet de l'arbre, le gestionnaire d'évènement est appelé.
 L'utilisateur peut également changer la sélection en utilisant les touches de déplacement. Si l'utilisateur
appuie en continu sur une touche de déplacement afin de se déplacer rapidement dans les objets, le
gestionnaire d'évènement n'est pas appelé jusqu'à ce que l'utilisateur arrête d'appuyer sur la touche. Cela
conduit à améliorer les performances. Cela signifie également que l'illumination du texte apparaîtra sur
plusieurs objets même si l'évènement select n'est pas déclenché pour ces items.
</p>
<p>
La syntaxe du gestionnaire d'évènement <code class="attribut">onselect</code> est présentée ci-dessous.
</p>

<pre><code>
&lt;tree id="treeset" onselect="alert('Vous avez sélectionné quelquechose!');"&gt;
</code></pre>

<p>
L'arbre possède une propriété <code class="attribut">currentIndex</code>, qui peut être utilisée pour
atteindre l'objet sélectionné, où la première ligne est <var>0</var>.</p>

<p>
Les éléments fils sont inclus dans le comptage juste après leurs parents. Cela signifie que s'il y a trois
objets racines et que chacun a deux objets fils, il y aura un total de six objets. Le premier objet (à
l'index <var>0</var>) sera le premier objet racine. L'objet suivant à l'index <var>1</var> sera son premier fils. Le second fils
sera à l'index <var>2</var> et le second objet parent sera à la postion <var>3</var> et ainsi de suite.
</p>


<p><img src="images/seltree1.png" alt="exemple d'arbre à sélection multiple" class="screenshot-right" />
Dans l'image située à droite, il y a huit lignes affichées, dont deux sont sélectionnées. La première ligne
sélectionnée a un index de <var>4</var> et la seconde, un index de <var>7</var>. Les lignes qui ne sont pas affichées ne sont pas
incluses dans le comptage d'index.
</p>


<p>
Pour les arbres qui permettent une sélection multiple, obtenir la liste des lignes sélectionnées est un peu
plus compliqué. L'élément <code class="tag">tree</code> a une propriété <code class="attribut">view</code>
laquelle dispose d'une propriété <code class="attribut">selection</code> qui contient des propriétés et
des méthodes liées à la sélection courante de l'arbre . Vous pouvez utiliser ces méthodes pour récupérer
le jeu d'objet sélectionnés ou pour modifier la sélection.
</p>
<p>
Comme les objets sélectionnés dans une sélection multiple ne sont pas nécéssairement contigus, vous pouvez
récupérer chaque bloc de sélection contigue en utilisant les fonction <code>getRangeCount</code> et
<code>getRangeAt</code>.
La première fonction retourne le nombre de plages de sélection qu'il y a. Si une seule valeur est
sélectionnée, la valeur retournée sera <var>1</var>. Vous pourrez alors écrire une boucle pour le nombre de plage, en
appelant <code>getRangeAt</code> pour obtenir les bons index du début et de la fin de la plage.
</p>

<p>
La fonction <code>getRangeAt</code> comporte trois arguments. Le premier est la plage d'index.
Le second est un objet
qui sera rempli par la fonction avec l'index du premier objet sélectionné. Le troisième argument est un
objet qui sera rempli avec l'index du dernier objet sélectionné.
</p>
<p>Par exemple&nbsp;:</p>

<pre><code>
var start = new Object();
var end = new Object();
var numRanges = tree.view.selection.getRangeCount();

for (var t=0; t&lt;numRanges; t++){
  tree.view.selection.getRangeAt(t,start,end);
  for (var v=start.value; v&lt;=end.value; v++){
    alert("Objet "+v+" sélectionné.");
  }
}
</code></pre>

<p>
Nous avons créé deux objet appelés <code>start</code> et <code>end</code>. Ensuite, nous lancons une boucle sur les plages de
sélection dont le nombre a été retourné par la fonction <code>getRangeCount</code>. La fonction
<code>getRangeAt</code> est appelée
avec la plage d'index et les objets <code>start</code> et <code>end</code>. Cette fonction remplira
les index <code>start</code> et <code>end</code> en leur
attribuant la propriété <var>value</var>. Donc, si la première plage commence au troisième objet et
se termine au
septième, <code>start.value</code> vaudra <var>2</var> (souvenez-vous que les index commencent à 0,
donc nous en enlevons un)
et <code>end.value</code> vaudra <var>6</var>. Une alerte est affichée pour chaque index.
</p>
<hr />

<p>
Nous allons maintenant apprendre comment créer une vue personnalisée pour un arbre.
</p>


