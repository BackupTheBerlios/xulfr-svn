
<p class="note"><acronym title="Note du Traducteur">NdT&nbsp;: Attention, 
cette section décrit le mécanisme XPInstall propre à la suite Mozilla et 
à des versions anciennes de Mozilla Firefox. Pour les versions récentes de Mozilla Firefox, 
ce mode d'installation n'est plus le même, mais il n'est pas encore décrit dans ce tutoriel.
Voir <a href="http://xulfr.org/wiki/ExtensionsFirefox">comment faire des extensions pour firefox</a> sur xulfr.org.</p>

<p>Cette section décrit quelques spécificités supplémentaires
des programmes d'installation.</p>

<h2>Manipulation de fichiers lors de l'installation</h2>

<p>La section précédente décrivait un programme d'installation
simple. Vous pouvez souhaiter réaliser quelques opérations
plus élaborées pendant l'installation. Par exemple, vous voulez
installer un paquetage seulement si certaines conditions sont réunies,
comme d'avoir une librairie particulière installée.</p>

<p>En complément de l'objet <code>Install</code>, l'objet <code>File</code>
est également disponible pendant le script d'installation. Il fournit
quelques fonctions qui peuvent être employées pour examiner
et modifier des fichiers sur le disque. Vous pouvez les utiliser pour déplacer,
copier ou effacer des fichiers avant ou après que les fichiers
du paquetage soient installés. Par exemple, vous voulez peut être
faire une sauvegarde de quelques fichiers d'abord.</p>

<p>Le code ci dessous fera une copie du fichier &quot;/bin/grep&quot; dans
le répertoire &quot;/main&quot;.</p>

<pre><code>var binFolder=getFolder(&quot;file:///&quot;,&quot;bin&quot;);
var grep=getFolder(binFolder,&quot;grep&quot;);

var mainFolder=getFolder(&quot;file:///&quot;,&quot;main&quot;);

File.copy(grep,mainFolder);</code></pre>

<p>La première ligne va renseigner un pointeur sur le répertoire
<var>/bin</var>. Le texte <var>file:///</var> est une chaîne de caractères
spéciale qui correspond à la racine du système de fichiers.
À partir de ce pointeur, nous récupérons le fichier <var>grep</var>
qui se trouve dans le répertoire <var>bin</var>. Si ce fichier n'existe
pas, une erreur sera signalée au processus d'installation. Ensuite,
nous pointons sur le répertoire <var>main</var>, toujours à
partir de la racine du système de fichiers. Finalement, nous appelons
la fonction <var>File.copy</var> qui copie le fichier source vers
sa destination.</p>

<p><a href="http://www.xulplanet.com/references/elemref/ref_File.html">Des fonctions</a> 
existent également pour déplacer, renommer et exécuter des fichiers. Ainsi, vous pouvez déplacer des
fichiers qui peuvent se trouver en conflit avec votre paquetage.</p>

<h2>Interception des erreurs</h2>

<p>Vous voulez certainement intercepter d'éventuelles erreurs proprement.
Elles peuvent se produire si un fichier ou un répertoire ne peut pas
être trouvé, si la capacité du disque n'est pas suffisant
ou pour toutes autres raisons.</p>

<p>Il vous suffit d'appeler la fonction <code>getLastError</code> pour
déterminer si une erreur a été rencontrée. Si
elle renvoie <var>SUCCESS</var>, aucune erreur ne s'est produite. Autrement,
elle renvoie un nombre qui indique le code d'erreur. Vous pouvez appeler
cette fonction en tout point de votre script d'installation pour déterminer
si une erreur est survenue lors de la dernière opération effectuée.</p>

<p>Si une erreur se produit, vous voulez sûrement interrompre l'installation.
Vous pouvez également vouloir afficher un message d'erreur pour l'utilisateur.
Par exemple, vous pourriez mettre le script suivant à la fin de votre
script d'installation&nbsp;:</p>

<pre><code>if (getLastError() == SUCCESS){
   performInstall();
}
else {
   cancelInstall();
}</code></pre>

<p>Les codes d'erreur susceptibles d'être renvoyés par la fonction
<code>getLastError</code> sont listés dans le fichier source
de Mozilla <a href="http://lxr.mozilla.org/mozilla/source/xpinstall/src/nsInstall.h">nsInstall.h</a>.
Pendant l'installation, un suivi d'événements contenant les
opérations réalisées est créé. Il contiendra
également toutes les erreurs qui se sont produites. Ces événements
peuvent être trouvés dans le fichier <var>install.log</var> dans le
répertoire d'installation de Mozilla. Un bloc de texte sera ajouté
à ce fichier à chaque installation effectuée.</p>

<p>La fonction <code>logComment</code> peut être utilisée
pour écrire un texte dans ce fichier d'événements.
Elle nécessite un seul argument qui est le contenu du texte.</p>

<hr />

<p>Le Tutoriel XUL est terminé.</p>


