
<p>
Dans cette section, nous allons voir comment mettre les fichiers XUL et chrome
dans un paquetage et créer les fichiers contents.rdf associés.
</p>

<h2>Paquetages</h2>

<p>
Un paquetage est un ensemble de fichiers XUL et de scripts qui définissent la
fonctionnalité d'une interface utilisateur.
Les paquetages peuvent être installés dans Mozilla et référencés avec des URLs chrome.
Un paquetage peut contenir tous les fichiers que l'on veut et peut-être découpé
en sous-répertoires pour les différentes parties du paquetage. Par exemple,
les marque-pages et l'historique font partie du paquetage communicator, mais sont
stockés dans des sous-répertoires différents.
</p>

<p> Un paquetage peut-être stocké comme un répertoire ou comme
  une archive JAR. Chaque paquetage aura un fichier manifest, contents.rdf, qui
  décrit le paquetage. Ce fichier sera placé dans le fichier JAR
  au côté des fichiers qu'il décrit. Le fichier doit s'appeler
  contents.rdf et être un fichier au format RDF (Resource Description Framework).
  Nous en apprendront plus à propos de RDF ultérieurement.</p>

<h2>Les fichiers contents.rdf</h2>

<p>Le fichier contents.rdf décrit les contenus d'un paquetage. Il peut
  aussi être utilisé pour décrire un thème ou une localisation.
  Ces fichiers manifest sont assez faciles à créer une fois que
  vous savez comment faire. Le modèle ci-dessous peut-être utilisé
  comme point de départ.</p>


  <pre><code>&lt;?xml version="1.0"?&gt;

&lt;RDF:RDF xmlns:RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:chrome="http://www.mozilla.org/rdf/chrome#"&gt;

  &lt;RDF:Seq RDF:about="urn:mozilla:package:root"&gt;
    &lt;RDF:li RDF:resource="urn:mozilla:package:monapplication"/&gt;
  &lt;/RDF:Seq&gt;

  &lt;RDF:Description RDF:about="urn:mozilla:package:monapplication"
        chrome:displayName="Mon Application"
        chrome:author="nom"
        chrome:name="monapplication"&gt;
  &lt;/RDF:Description&gt;

&lt;/RDF:RDF&gt;</code></pre>



<p>Vous pouvez utiliser ce modèle et effectuer quelques petites modifications
  spécifiques pour votre paquetage. Décomposons celui-ci pour comprendre
  la fonction de chaque bloc.</p>

<pre><code>&lt;?xml version="1.0"?&gt;

&lt;RDF:RDF xmlns:RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:chrome="http://www.mozilla.org/rdf/chrome#"&gt;
</code></pre>

<p>Ces trois lignes doivent être placées au tout début du
  fichier contents.rdf. Parce que RDF est un format XML, il contient les mêmes
  premières lignes standards que tout fichier XML doit posséder.
  Ensuite, nous déclarons les espaces de nom qui vont être utilisés,
  un pour RDF et un autre pour le système chrome. Si vous ne comprenez
  pas ce que cela signifie, ne vous inquiétez pas. Ajoutez les simplement
  au début du fichier.</p>

<pre><code>&lt;RDF:Seq RDF:about="urn:mozilla:package:root"&gt;
  &lt;RDF:li RDF:resource="urn:mozilla:package:monapplication"/&gt;
&lt;/RDF:Seq&gt;
</code></pre>

<p>Ces lignes sont utilisées pour déclarer quels paquetages, thèmes
  et localisations sont décrits par le fichier manifest. Dans le cas présent,
  c'est un paquetage qui va être décrit (comme indiqué par
  le mot <var>package</var> dans le texte).
  Si vous créez un thème, vous mettriez <var>skin</var> à la place de <var>package</var>, et si vous créez
  une localisation, vous utiliseriez <var>locale</var>.
  Le nom du paquetage ici est <var>monapplication</var>.
  Bien entendu, il faudra le remplacer par le nom du paquetage que vous allez
  créer. Par exemple, l'application de courrier électronique de
  Mozilla se nomme 'messenger'.
  Le nom doit être court et significatif. Ce nom sera utilisé dans les URLs chrome pour le paquetage.
  </p>

<p>La balise <code class="tag">RDF:li</code> ci-dessus est similaire à
  la balise <code class="tag">li</code> du HTML, elle déclare un élément de liste.
  Ainsi, vous pouvez déclarez plusieurs paquetages par l'utilisation de
  plusieurs balises <code class="tag">RDF:li</code>.</p>

<p>Pour les thèmes, remplacez les deux occurences de <var>package</var> par <var>skin</var>&nbsp;;
  pour les localisations, remplacez les deux occurences de <var>package</var> par <var>locale</var>.
  Par exemple, ce qui suit spécifie un thème&nbsp;:</p>

<pre><code>&lt;RDF:Seq RDF:about="urn:mozilla:skin:root"&gt;
  &lt;RDF:li RDF:resource="urn:mozilla:skin:blueswayedshoes"/&gt;
&lt;/RDF:Seq&gt;
</code></pre>

<!--<p>Les seules différences sont les remplacements des deux occurences du
  mot <var>package</var> par <var>skin</var> et le remplacement pour le nom de
  thème <var>blueswayedshoes</var>.</p>-->
<p>La partie suivante spécifie le nom et l'auteur de l'application&nbsp;:</p>

<pre><code>  &lt;RDF:Description RDF:about="urn:mozilla:package:monapplication"
        chrome:displayName="Mon Application"
        chrome:author="nom"
        chrome:name="monapplication"&gt;
  &lt;/RDF:Description&gt;
</code></pre>



<p>Ce bloc est utilisé pour fournir plus de détails sur le paquetage,
  le thème ou la localisation. Vous aurez besoin d'une description pour
  chaque balise <code class="tag">li</code>. La valeur de l'attribut
  <code class="attribut">about</code> devrait être identique
  à l'attribut <code class="attribut">ressource</code> de la balise
  <code class="tag">li</code>.</p>

<p>Les trois attributs supplémentaires donnent des informations sur le
  paquetage.</p>

<dl>
<dt><code class="attribut">displayName</code></dt>
   <dd>Le titre du paquetage tel qu'il devra être affiché à
   l'utilisateur. Par exemple, 'Messenger'.</dd>
<dt><code class="attribut">author</code></dt>
   <dd>Le nom de l'auteur du paquetage.</dd>
<dt><code class="attribut">name</code></dt>
   <dd>Le nom du paquetage, du thème ou de la localisation.<!-- Ordinairement,
   cela devrait être le même nom que le répertoire où
   il est stocké. -->
   Il devrait avoir la même valeur que ce qui vient après <var>urn:mozilla:package:</var> qui était spécifiée précédemment.
   Ce nom est utilisé comme première partie d'une URL chrome.</dd>
</dl>

<p>Vous pouvez aussi utiliser une variété d'autres valeurs. Quand Mozilla déclare votre paquetage,
ces valeurs sont ajoutées dans le registre chrome.</p>

<div class="task">

      <p>Écrivons un fichier contents.rdf pour la boîte de dialogue de recherche
        de fichiers que nous voulons créer. Il sera nécessaire de décrire
        le paquetage. Comme il n'y a pas de sous-paquetages, de thèmes ou de
        localisations, il est assez semblable au modèle vu plus haut.</p>

        <pre><code>&lt;?xml version="1.0"?&gt;

&lt;RDF:RDF xmlns:RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
      xmlns:chrome="http://www.mozilla.org/rdf/chrome#"&gt;

  &lt;RDF:Seq RDF:about="urn:mozilla:package:root"&gt;
    &lt;RDF:li RDF:resource="urn:mozilla:package:findfile"/&gt;
  &lt;/RDF:Seq&gt;

  &lt;RDF:Description RDF:about="urn:mozilla:package:findfile"
    chrome:displayName="Recherche de fichiers"
    chrome:author="N'importe qui"
    chrome:name="findfile"&gt;
  &lt;/RDF:Description&gt;

&lt;/RDF:RDF&gt;</code></pre>

      <p>Ici, le composant est appelé 'findfile' ce qui signifie que nous
      seront capable de le référencer en utilisant l'URL chrome
      suivante&nbsp;: </p>

      <pre><code>chrome://findfile/content/findfile.xul
      </code></pre>

</div>

    <h2>Installer un Paquetage</h2>

    <p>La liste des paquetages installés est enregistrée dans le fichier chrome.rdf du le répertoire
      chrome. Vous devriez ne pas modifier ce fichier directement.
      Il est modifié automatiquement quand vous installez un nouveau paquetage.
      Comme pour les fichiers contents.rdf, c'est un fichier au format RDF. À
      première vue, il a l'air tout à fait différent des
      fichiers contents.rdf, mais si vous êtes familier de RDF, vous noterez que
      c'est en fait très proche.</p>

    <p>Chaque fois que Mozilla démarre, il parcourt le répertoire chrome
      à la recherche d'un fichier nommé 'installed-chrome.txt'. Ce fichier
      contient une liste, dans un format très simple, de tous les paquetages,
      thèmes et localisations qui sont installés. Si ce fichier est
      modifié, Mozilla parcourt chaque entrée dans la liste et les enregistre
      ou les met à jour si nécessaire de sorte qu'elles puissent être
      utilisées.</p>

    <p>Donc, pour enregistrer un nouveau paquetage, tout ce que vous avez à
      faire c'est de rajouter une entrée au fichier 'installed-chrome.txt'
      et de redémarrer Mozilla. Le nouveau paquetage sera enregistré et le
      fichier chrome.rdf sera régénéré puisqu'il doit
      nécessairement contenir le paquetage nouvellement installé. Mozilla
      possède également un système d'installation appelé
      XPInstall qui permet à des scripts d'installer automatiquement des paquetages
      via javascript sans avoir à modifier manuellement ce fichier. XPInstall
      sera décrit vers la fin de ce tutoriel. Cependant, pendant le développement,
      nous pouvons modifier directement le fichier.</p>

    <p>Le fichier 'installed-chrome.txt' se trouve dans le répertoire chrome.
      Le fichier contient une liste d'entrée à installer, une par ligne.
      Par exemple&nbsp;:</p>

    <pre><code>content,install,url,resource:/chrome/findfile/content/findfile/
skin,install,url,resource:/chrome/findfile/skin/findfile/</code></pre>

    <p>Ce qui précède sera utilisé pour installer le paquetage,
      ainsi qu'un thème, pour la recherche de fichier. Le format de chaque ligne
      est assez simple. Il s'agit juste de quatre valeurs séparées par
      des virgules&nbsp;:</p>

    <dl>
      <dt><code class="attribut">Type</code></dt>
        <dd>Mettez <var>content</var> pour les paquetages chrome, <var>skin</var> pour les thèmes
        ou <var>locale</var> pour les localisations.</dd>
      <dt><code class="attribut">Install</code></dt>
        <dd>Mettez le texte <var>install</var> pour que cette entrée soit installée.
        Pour les thèmes et les localisations, vous pouvez aussi mettre <var>profile</var>
        à la place pour installer cette entrée dans le répertoire
        profil de l'utilisateur. Elle ne sera installée et déclarée que 
        pour un utilisateur en particulier.</dd>
      <dt><code class="attribut">Type d'URL</code></dt>
        <dd>Mettez le texte <var>url</var> pour spécifier une URL indiquant où le
        nouveau paquetage, thème ou localisation est stocké. Si vous
        utilisez <var>path</var> à la place, vous pouvez utiliser un chemin de fichier
        (qui devra être au format de votre système d'exploitation).</dd>
      <dt><code class="attribut">URL</code></dt>
        <dd>Mettez l'URL ou le chemin de l'emplacement du paquetage. Ce devrait être
        le répertoire contenant le fichier contents.rdf ou le chemin et le
        nom du fichier JAR. Comme on se réfère à un répertoire,
        assurez vous qu'il y'a une barre oblique de division (<em>slash</em>) à
        la fin sinon le paquetage ne sera pas trouvé.</dd>
    </dl>


    <p class="note">Notez que les URLs utilisées sont des URLs <var>resource:/</var>. Vous pouvez
       tout aussi bien utiliser des URLs de fichiers.

      L'URL de ressource est similaire aux URLs de fichiers, excepté
      qu'elle commence par <var>resource:</var> au lieu de <var>file:</var> et que son répertoire
      de base est le répertoire où Mozilla est installé plutôt que
      la racine du système de fichier. Cela signifie qu'elle peut être
      utilisée pour faire référence à des fichiers dans
      le répertoire de Mozilla ou dans ses sous-répertoires, indépendamment
      de l'emplacement où est installé Mozilla. L'URL de ressource
      doit avoir une seule barre de division après les deux points puisqu'il s'agit
      toujours d'un chemin relatif.</p>

    <p>Ainsi, la ligne supplémentaire doit pointer vers le dossier où
      se trouve le fichier contents.rdf. Si vous avez plus d'un paquetage, ajoutez
      une ligne pour chacun d'eux. </p>

    <p>Bien que Mozilla suive une convention de nommage des répertoires, vous
      pouvez mettre les fichiers où vous voulez. Par exemple, la ligne suivante
      installera un nouveau paquetage qui se trouve dans le répertoire /main/calculator/.</p>

    <pre><code>content,install,path,file:///main/calculator/</code></pre>

    <p>Vous pourrez noter également que des lignes du fichier installed-chrome.txt ont
     un autre type d'URL, le type <var>jar:</var>.
      Si vous compressez vos fichiers dans un fichier JAR, vous pouvez utiliser une
      URL JAR pour le référencer. Elle possède deux parties,
      séparées par un point d'exclamation (!). La première partie
      est l'URL du fichier JAR et la seconde partie est le répertoire ou le
      fichier dans l'archive. L'exemple ci-dessous pourrait référencer
      la boîte de dialogue de recherche de fichiers&nbsp;:</p>

    <pre><code>jar:resource:/chrome/findfile.jar!/content/findfile/</code></pre>
    <p>Cependant, vous n'aurez pas besoin normalement de faire attention aux URLs JAR quand
    vous créerez vos propres paquetages. Vous garderez plutôt les paquetages décompressés et
    vous vous y référerez en utilisant les types d'URLs fichier ou ressource.</p>

    <h2>Résumé</h2>

    <!--<p>En résumé, les étapes suivantes sont nécessaires
      pour installer un paquetage, un thème ou une localisation. Vous n'avez
      pas besoin d'installer les fichiers XUL, mais vous serez limité par ce
      que les scripts seront autorisés à faire.</p>-->
    <p>Les informations présentées ci-dessus peuvent avoir été confuses. Voici donc un guide rapide
    pour créer un simple paquetage. Vous pourrez suivre simplement les étapes du dessous
   et essayer de regarder les détails sur le fonctionnement de l'installation d'un paquetage
   une fois que vous serez plus familier avec XUL.</p>

   <!--<ol>
      <li>Créer un répertoire pour votre paquetage, thème ou
        localisation. La convention voudrait qu'il s'y trouve un sous-répertoire
        qui sera soit 'content', soit 'skin', soit 'locale' et à l'intérieur,
        un sous-répertoire avec le même nom que le paquetage.</li>
      <li>Créer un fichier contents.rdf comme expliqué plus haut et
        le mettre dans le répertoire.</li>
      <li>Ajouter une ligne au fichier 'installed-chrome.txt' du répertoire
        chrome pointant vers le nouveau répertoire.</li>
      <li>Démarrer Mozilla. Le nouveau paquetage sera automatiquement installé.</li>
    </ol>-->

    <ol>
    <li>Créez un répertoire quelque part sur votre disque. Beaucoup de gens le mettent
        comme un sous-répertoire à l'interieur du repertoire chrome de Mozilla, mais ce
    n'est pas nécéssaire. Le répertoire peut être n'importe où sur le disque. Mettez
    vos fichiers XUL dans ce répertoire.</li>
    <li>Créez un fichier appelé <var>contents.rdf</var> et placez le dans ce répertoire. Copiez
    le texte de la boîte du dessous dans ce nouveau fichier. Il est utilisé pour identifier
        l'identifiant (id) de votre application, son nom, son auteur, la version etc.
         <pre><code>
&lt;?xml version="1.0"?&gt;

&lt;RDF:RDF xmlns:RDF="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:chrome="http://www.mozilla.org/rdf/chrome#"&gt;

  &lt;RDF:Seq RDF:about="urn:mozilla:package:root"&gt;
    &lt;RDF:li RDF:resource="urn:mozilla:package:<strong>myapplication</strong>"/&gt;
  &lt;/RDF:Seq&gt;

  &lt;RDF:Description RDF:about="urn:mozilla:package:<strong>myapplication</strong>"
          chrome:displayName="<span style="color:blue">Application Title</span>"
          chrome:author="<span style="color:blue">Author Name</span>"
          chrome:name="<strong>myapplication</strong>"
          chrome:extension="true"/&gt;

&lt;/RDF:RDF&gt;
</code></pre></li>

    <li>Changez les parties colorées du fichier du dessus avec vos propres informations.
        Le texte rouge <var>myapplication</var> doit être l'ID de votre application.
        Vous l'inventerez, mais typiquement l'ID est similaire au nom de votre application.
        Remplacez le texte coloré en bleu avec le titre et l'auteur de l'application.</li>
       <li>Si le champ <code>chrome:extension</code> est à <var>true</var>, l'application
       est alors une extension Firefox et apparaîtra dans la fenêtre des extensions du navigateur.
       Si c'est <var>false</var>, elle n'apparaîtra pas.
       </li>
       <li>Sauvez le fichier contents.rdf et soyez sûr qu'il est dans le répertoire créé lors de
         l'étape 1.</li>
       <li> Ouvrez le fichier
          &lt;mozilla-directory&gt;/chrome/installed-chrome.txt, où
         &lt;mozilla-directory&gt; est le répertoire d'installation de Mozilla. Quitter Mozilla au préalable.
       </li>
       <li>Ensuite nous allons déclarer la nouvelle application dans Mozilla ainsi il saura où la trouver.
       Ajoutez une ligne à la fin du fichier installed-chrome.txt pointant vers le nouveau
        répertoire que vous avez créé.
<pre><code>
content,install,url,<strong>file:///main/app/</strong>.
</code></pre>
       Changez le texte coloré par l'URL de fichier du répertoire. Soyez sûr que l'URL se termine bien
       avec un slash et que vous avez pressé <kbd>enter</kbd> à la fin de la ligne. Si vous n'êtes pas
       sûr de l'URL, ouvrez le répertoire créé à l'étape 1 dans le navigateur et copiez l'URL à partir
       de la barre d'adresse. Notez que la référence doit être un répertoire, pas un fichier.
       </li>
       <li>Effacez le fichier
   &lt;mozilla-directory&gt;/chrome/chrome.rdf .</li>
       <li> Démarrer Mozilla. Vous devriez pouvoir voir n'importe quel fichier que vous mettez
       dans le répertoire en utilisant une URL de la forme <code>chrome://<strong>applicationid</strong>/content/fichier.xul</code>, 
       où fichier.xul est le nom du fichier. Votre fichier principal xul doit être applicationid.xul ce qui
       vous permet de le charger en utilisant le raccourci <code>chrome://<strong>applicationid</strong>/content/</code>.</li>
</ol>
<p>Si vous avez créé des thèmes ou des localisations, répétez les étapes précédentes, excepté que le
format du fichier contents.rdf est légèrement différent. Regardez les fichiers contents.rdf d'autres
applications pour plus de détails.</p>


<h2>Résolution de problèmes</h2>

<p>La création d'un paquetage chrome peut souvent être délicat et il est difficile de
diagnostiquer les problèmes. Voici quelques astuces si vous n'y arrivez pas.</p>

<ul>
   <li> Ouvrez le fichier
    &lt;mozilla-directory&gt;/chrome/chrome.rdf. Vous devriez trouver des références à
    l'ID de votre application. Si ce n'est pas le cas, quelque chose s'est mal passé avec la déclaration.
    Si elles y sont, vous avez problablement utilisé une mauvaise URL chrome quand vous chargez le fichier.</li>
   <li>Essayez d'effacer le fichier
     &lt;mozilla-directory&gt;/chrome/chrome.rdf. Il sera régénéré.

    Effacez aussi tout le répertoire &lt;mozilla-directory&gt;/chrome/overlayinfo/ si vous utilisez
    les overlays.</li>
    <li>Soyez sûr que l'URL de la ligne que vous avez ajouté au fichier installed-chrome.txt se termine
     bien par un slash, et que le fichier se termine par une ligne vide.</li>
    <li>Sous windows, les URLs de fichier sont de la forme file:///C:/files/app/ où C est la lettre du lecteur</li>
    <li>Soyez sûr que le fichier contents.rdf est dans le bon répertoire et est bien formé. Ouvrez
    le fichier contents.rdf dans Mozilla pour voir si il l'analyse bien comme étant du XML sans erreur.
    Si ce n'est pas le cas, vous verrez une erreur sur un fond jaune.</li>
   <li>Si vous utilisez une version debug de Mozilla, certaines informations seront affichées dans
    le terminal au démarrage, indiquant quelles applications chrome ont été vérifiées. Verifiez si
    votre application est listée.</li>
</ul>
<hr />
    <p>
    Dans le prochain chapitre, nous commencerons l'examen du langage XUL.
    </p>



