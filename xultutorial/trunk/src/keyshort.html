


<p>
Vous pourriez utiliser les gestionnaires d'évènement clavier pour réagir aux touches pressées. Cependant,
ce serait ennuyeux de le faire pour chaque bouton et item de menu.
</p>

<h2>Créer un raccourci clavier</h2>

<p>
XUL fournit des méthodes par lesquelles vous pouvez définir des raccourcis clavier. Nous avons déjà
vu dans la section sur les menus que nous pouvons définir un attribut appelé
<code class="attribut">accesskey</code> qui spécifie quelle touche un utilisateur peut presser pour
activer le menu ou l'item de menu. Dans l'exemple ci-dessous, le menu Fichier peut être sélectionné
en pressant <kbd>Alt</kbd> et <kbd>F</kbd> (ou quelqu'autre combinaison de touches spécifique à une
plateforme). Une fois le menu Fichier ouvert, l'item de menu Fermer peut être
sélectionné en pressant <kbd>F</kbd>.
</p>

<p>
Exemple 6.3.1&nbsp;:
    <a href="exemples/ex_keyshort_1.xul.txt">Source</a>
    <a href="exemples/ex_keyshort_1.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a>
</p>
<pre><code>&lt;menubar id="sample-menubar"&gt;
  &lt;menu id="file-menu" label="Fichier" accesskey="f"&gt;
    &lt;menupopup id="file-popup"&gt;
      &lt;menuitem id="close-command" label="Fermer" accesskey="f"/&gt;
    &lt;/menupopup&gt;
  &lt;/menu&gt;
&lt;/menubar&gt;</code></pre>

<p>
Vous pouvez aussi utiliser l'attribut <code class="attribut">accesskey</code> sur les
boutons. Dans ce cas, quand la touche est pressé, le bouton est sélectionné.
</p>

<p>
Cependant, vous pourriez vouloir mettre en place des raccourcis clavier plus généraux. Par
exemple, presser <kbd>Ctrl</kbd>+<kbd>C</kbd> pour copier du texte dans le presse-papier.
Bien que de tels raccourcis puissent n'être pas toujours valide, ils vont usuellement
fonctionner dès lors que la fenêtre est ouverte. Normalement, un raccourci sera
autorisé à n'importe quel moment et vous pourrez vérifier via un script s'il doit faire
quelque chose. Par exemple, copier du texte dans le presse-papier devrait marcher
seulement quand du texte est sélectionné.
</p>

<p>
XUL fournit un élément, <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/key">key</a></code>,
qui vous permet de définir un raccourci clavier pour une fenêtre. Il a des attributs pour
spécifier la touche qui doit être pressée et quelles touches de modification (comme Maj ou
Ctrl) doivent l'accompagner. Un exemple&nbsp;:
</p>

<pre><code>&lt;keyset&gt;
  &lt;key id="sample-key" modifiers="shift" key="R"/&gt;
&lt;/keyset&gt;</code></pre>

<p>
Cette exemple définit un raccourci clavier qui est activé lorsque l'utilisateur presse
les touches <kbd>Maj</kbd> et <kbd>R</kbd>. L'attribut <code class="attribut">key</code>
(notez qu'il a le même nom que l'élément lui-même) peut être utilisé pour indiquer
quelle touche doit être pressée, dans ce cas <kbd>R</kbd>. Vous pouvez ajouter n'importe
quelle caractère dans cet attribut pour rajouter ce caractère aux touches requérant d'être
pressées. Les touches de modification qui doivent être pressées sont indiquées par l'attribut
<code class="attribut">modifiers</code>. C'est une liste de touches de modification séparées par
des espaces, ces touches de modification se trouvant dans la liste ci-dessous :
</p>

<dl>
    <dt><var>alt</var></dt>
    <dd>L'utilisateur doit presser la touche <kbd>Alt</kbd></dd>
    <dt><var>control</var></dt>
    <dd>L'utilisateur doit presser la touche <kbd>Ctrl</kbd></dd>
    <dt><var>meta</var></dt>
    <dd>L'utilisateur doit presser la touche <kbd>Meta</kbd>. C'est la touche
        <kbd>Command</kbd> sous Macintosh.</dd>
    <dt><var>shift</var></dt>
    <dd>L'utilisateur doit presser la touche <kbd>Shift</kbd> (<kbd>Maj</kbd>)</dd>
    <dt><var>accel</var></dt>
    <dd>L'utilisateur doit presser la touche de raccourci spécifique
        à sa plateforme.</dd>
</dl>

<p>
Votre clavier n'aura pas forcément toutes ces touches, auquel cas elles seront
transférés sur les touches de modification que vous possédez.
</p>

<p>
L'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/key">key</a></code> doit être
placé à l'intérieur d'un élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/keyset">keyset</a></code>.
Cet élément est destiné à contenir un ensemble d'éléments <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/key">key</a></code>
qui sert à grouper toutes les définitions de raccourcis dans un seul emplacement du fichier. Un élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/key">key</a></code> à l'extérieur d'un élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/keyset">keyset</a></code> ne sera pas pris en compte.
</p>

<p>
Généralement, chaque plateforme utilise une touche différente pour les raccourcis clavier. Par exemple,
Windows utilise la touche <kbd>Ctrl</kbd> tandis que Macintosh utilise la touche <kbd>Command</kbd>. Il
serait peu commode de définir un élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/key">key</a></code>
séparé pour chaque plateforme. Heureusement, il y a une solution, la touche de modification <var>accel</var> se
réfère à la touche de raccourci spécifique à la plateforme. Il marche exactement comme les autres
touches de modification excepté qu'il change selon la plateforme.
</p>

<p>
Quelques exemples supplémentaires&nbsp;:
</p>

<pre><code>&lt;keyset&gt;
  &lt;key id="copy-key" modifiers="control" key="C"/&gt;
  &lt;key id="explore-key" modifiers="control alt" key="E"/&gt;
  &lt;key id="paste-key" modifiers="accel" key="V"/&gt;
&lt;/keyset&gt;</code></pre>

<p>
L'attribut <code class="attribut">key</code> est utilisé pour spécifier quelles touches doivent
être pressées. Toutefois, il y aura aussi des cas où vous voudrez spécifier des touches qui ne
peuvent être décrites par un simple caractère (telle que la touche <kbd>Enter</kbd> ou les
touches de fonctions). L'attribut <code class="attribut">key</code> peut seulement être utilisé
pour des caractères imprimables. Un autre attribut, <code class="attribut">keycode</code> peut
être utilisé pour les caractères non imprimables.
</p>

<p>
La valeur de l'attribut <code class="attribut">keycode</code> doit être un code spécial qui
représente la touche que vous voulez. Une liste des touches est disponible ci-dessous.
Toutes les touches ne sont pas disponibles sous toutes les plateformes.
</p>

<table class="listetouches">
   <tbody>
      <tr>
         <td>
            <ul>
               <li><var>VK_CANCEL</var></li>
               <li><var>VK_BACK</var></li>
               <li><var>VK_TAB</var></li>
               <li><var>VK_CLEAR</var></li>
               <li><var>VK_RETURN</var></li>
               <li><var>VK_ENTER</var></li>
               <li><var>VK_SHIFT</var></li>
               <li><var>VK_CONTROL</var></li>
               <li><var>VK_ALT</var></li>
               <li><var>VK_PAUSE</var></li>
               <li><var>VK_CAPS_LOCK</var></li>
               <li><var>VK_ESCAPE</var></li>
               <li><var>VK_SPACE</var></li>
               <li><var>VK_PAGE_UP</var></li>
               <li><var>VK_PAGE_DOWN</var></li>
               <li><var>VK_END</var></li>
               <li><var>VK_HOME</var></li>
               <li><var>VK_LEFT</var></li>
               <li><var>VK_UP</var></li>
               <li><var>VK_RIGHT</var></li>
               <li><var>VK_DOWN</var></li>
               <li><var>VK_PRINTSCREEN</var></li>
               <li><var>VK_INSERT</var></li>
               <li><var>VK_DELETE</var></li>
            </ul>
         </td>
         <td>
            <ul>
               <li><var>VK_0</var></li>
               <li><var>VK_1</var></li>
               <li><var>VK_2</var></li>
               <li><var>VK_3</var></li>
               <li><var>VK_4</var></li>
               <li><var>VK_5</var></li>
               <li><var>VK_6</var></li>
               <li><var>VK_7</var></li>
               <li><var>VK_8</var></li>
               <li><var>VK_9</var></li>
               <li><var>VK_A</var></li>
               <li><var>VK_B</var></li>
               <li><var>VK_C</var></li>
               <li><var>VK_D</var></li>
               <li><var>VK_E</var></li>
               <li><var>VK_F</var></li>
               <li><var>VK_G</var></li>
               <li><var>VK_H</var></li>
               <li><var>VK_I</var></li>
               <li><var>VK_J</var></li>
               <li><var>VK_K</var></li>
               <li><var>VK_L</var></li>
               <li><var>VK_M</var></li>
               <li><var>VK_N</var></li>
               <li><var>VK_O</var></li>
               <li><var>VK_P</var></li>
               <li><var>VK_Q</var></li>
               <li><var>VK_R</var></li>
               <li><var>VK_S</var></li>
               <li><var>VK_T</var></li>
               <li><var>VK_U</var></li>
               <li><var>VK_V</var></li>
               <li><var>VK_W</var></li>
               <li><var>VK_X</var></li>
               <li><var>VK_Y</var></li>
               <li><var>VK_Z</var></li>
            </ul>
         </td>
         <td>
            <ul>
               <li><var>VK_NUMPAD0</var></li>
               <li><var>VK_NUMPAD1</var></li>
               <li><var>VK_NUMPAD2</var></li>
               <li><var>VK_NUMPAD3</var></li>
               <li><var>VK_NUMPAD4</var></li>
               <li><var>VK_NUMPAD5</var></li>
               <li><var>VK_NUMPAD6</var></li>
               <li><var>VK_NUMPAD7</var></li>
               <li><var>VK_NUMPAD8</var></li>
               <li><var>VK_NUMPAD9</var></li>
               <li><var>VK_MULTIPLY</var></li>
               <li><var>VK_ADD</var></li>
               <li><var>VK_SEPARATOR</var></li>
               <li><var>VK_SUBTRACT</var></li>
               <li><var>VK_DECIMAL</var></li>
               <li><var>VK_DIVIDE</var></li>
               <li><var>VK_COMMA</var></li>
               <li><var>VK_PERIOD</var></li>
               <li><var>VK_SLASH</var></li>
               <li><var>VK_BACK_QUOTE</var></li>
               <li><var>VK_OPEN_BRACKET</var></li>
               <li><var>VK_BACK_SLASH</var></li>
               <li><var>VK_CLOSE_BRACKET</var></li>
               <li><var>VK_QUOTE</var></li>
               <li><var>VK_SEMICOLON</var></li>
               <li><var>VK_EQUALS</var></li>
            </ul>
         </td>
         <td>
            <ul>
               <li><var>VK_F1</var></li>
               <li><var>VK_F2</var></li>
               <li><var>VK_F3</var></li>
               <li><var>VK_F4</var></li>
               <li><var>VK_F5</var></li>
               <li><var>VK_F6</var></li>
               <li><var>VK_F7</var></li>
               <li><var>VK_F8</var></li>
               <li><var>VK_F9</var></li>
               <li><var>VK_F10</var></li>
               <li><var>VK_F11</var></li>
               <li><var>VK_F12</var></li>
               <li><var>VK_F13</var></li>
               <li><var>VK_F14</var></li>
               <li><var>VK_F15</var></li>
               <li><var>VK_F16</var></li>
               <li><var>VK_F17</var></li>
               <li><var>VK_F18</var></li>
               <li><var>VK_F19</var></li>
               <li><var>VK_F20</var></li>
               <li><var>VK_F21</var></li>
               <li><var>VK_F22</var></li>
               <li><var>VK_F23</var></li>
               <li><var>VK_F24</var></li>
               <li><var>VK_NUM_LOCK</var></li>
               <li><var>VK_SCROLL_LOCK</var></li>
               <li><var>VK_HELP</var></li>
            </ul>
         </td>
      </tr>
   </tbody>
</table>


<p>
Par exemple, pour créer un raccourci qui est activé quand l'utilisateur presse les touches
<kbd>Alt</kbd> et <kbd>F5</kbd>, faites ainsi&nbsp;:
</p>

<pre><code>&lt;keyset&gt;
  &lt;key id="test-key" modifiers="alt" keycode="VK_F5"/&gt;
&lt;/keyset&gt;</code></pre>

<p>
L'exemple ci-dessous montre quelques raccourcis clavier de plus&nbsp;:
</p>

<pre><code>&lt;keyset&gt;
  &lt;key id="copy-key" modifiers="accel" key="C"/&gt;
  &lt;key id="find-key" keycode="VK_F3"/&gt;
  &lt;key id="switch-key" modifiers="control alt" key="1"/&gt;
&lt;/keyset&gt;</code></pre>

<p>
Le premier raccourci est déclenché lorsque l'utilisateur presse la touche de raccourci
spécifique à sa plateforme et <kbd>C</kbd>. Le second est invoqué quand l'utilisateur
presse <kbd>F3</kbd>. Le troisième se déclenche sur une pression des touches
<kbd>Ctrl</kbd>, <kbd>Alt</kbd> et <kbd>1</kbd>. Si vous voulez distinguer les touches
de la partie centrale du clavier et les touches du pavé numérique, utiliser les touches
<var>VK_NUMPAD</var> (telles que <var>VK_NUMPAD1</var>).
</p>

<h2>Utiliser les raccourcis clavier</h2>

<p>
Maintenant que nous savons comment définir les raccourcis clavier, nous allons découvrir
comment les utiliser. Il y a deux manières. La première est la plus simple et requiert seulement
que vous utilisiez le gestionnaire d'évènement clavier sur l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/key">key</a></code>. Quand l'utilisateur
presse la (ou les) touche(s), le script est invoqué. Voici un exemple&nbsp;:
</p>

<pre><code>&lt;keyset&gt;
  &lt;key id="copy-key" modifiers="accel" key="C" onkeypress="DoCopy();"/&gt;
&lt;/keyset&gt;</code></pre>

<p>
La fonction <code>DoCopy</code> sera appelée quand l'utilisateur pressera les
touches spécifiées par l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/key">key</a></code>
qui sont dans cet exemple les touches pour copier dans le presse-papier (telles que
<kbd>Ctrl</kbd>+<kbd>C</kbd>). Ceci fonctionnera tant que la fenêtre sera ouverte.
La fonction <code>DoCopy</code> devrait vérifier si du texte est sélectionné et le copier
dans le presse-papier si tel est le cas. Notez que les boîtes de textes intègrent déjà les
raccourcis pour utiliser le presse-papier, de sorte que vous n'avez pas besoin de les
implémenter vous-même.
</p>

<p>
Si vous assignez un raccourci à une commande qui existe déjà dans un menu, vous pouvez associer
directement l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/key">key</a></code> avec
la commande du menu. Pour faire ceci, ajoutez un attribut <code class="attribut">key</code> à
l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/menuitem">menuitem</a></code>.
Donner lui comme valeur l'<code class="attribut">id</code> du raccourci que vous voulez lui
associer.
L'exemple ci-dessous montre cette méthode.
</p>

<p>
Exemple 6.3.2&nbsp;:
    <a href="exemples/ex_keyshort_2.xul.txt">Source</a>
    <a href="exemples/ex_keyshort_2.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a>
</p>
<pre><code>&lt;keyset&gt;
  &lt;key id="paste-key" modifiers="accel" key="V"
          oncommand="alert('invoque Coller')"/&gt;
&lt;/keyset&gt;
&lt;menubar id="sample-menubar"&gt;
  &lt;menu id="edit-menu" label="Editer" accesskey="e"&gt;
    &lt;menupopup id="edit-popup"&gt;
      &lt;menuitem id="paste-command" accesskey="c" key="paste-key" label="Coller"
                   oncommand="alert('invoque Coller')"/&gt;
    &lt;/menupopup&gt;
  &lt;/menu&gt;
&lt;/menubar&gt;</code></pre>

<p>
L'attribut <code class="attribut">key</code> de l'item du menu, qui est ici <var>paste-key</var>,
est égal à l'<code class="attribut">id</code> du raccourci défini. Vous pouvez utilisez ceci
aussi bien pour définir des raccourcis supplémentaires que pour affecter des raccourcis clavier
à n'importe quel nombre d'item de menu.
</p>

<p>
<img src="images/keyshort1.jpg" alt="capture d'écran de l'exemple 7.3.2" class="screenshot-left" />
Vous noterez aussi dans cette image que du texte a été placé à côté de la commande <var>Coller</var>
du menu pour indiquer que le raccourci <kbd>Ctrl</kbd>+<kbd>V</kbd> peut être pressé pour invoquer
la commande du menu. Ceci est ajouté automatiquement pour vous sur la base des touches de modification de
l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/key">key</a></code>. Les raccourcis
associés aux menus fonctionneront même si le menu n'est pas ouvert.
</p>

<p>
Une fonctionnalité supplémentaire des définitions de raccourcis est que vous pouvez les
désactivez facilement. Pour faire cela ajoutez un attribut <code class="attribut">disabled</code>
à l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/key">key</a></code> et affectez lui
la valeur <var>true</var>. Ceci désactive le raccourci clavier de façon à ce qu'il ne puisse
être invoqué. Il est utile de modifier l'attribut <code class="attribut">disabled</code> par
le biais d'un script.
</p>


<h2>Exemples de raccourcis</h2>

<div class="task">
<p>
Ajoutons des raccourcis clavier à la boîte de dialogue de recherche de fichiers.
Nous en ajouterons quatre, un pour chacune des commandes Couper, Copier et Coller, et
aussi un pour la commande Fermer quand l'utilisateur presse <kbd>Esc</kbd>
</p>
<p> <a href="exemples/findfile/findfile-keyshort.xul.txt">Source</a>
<a href="exemples/findfile/findfile-keyshort.xul"
onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a></p>

<pre><code><strong>&lt;keyset&gt;
  &lt;key id="cut_cmd" modifiers="accel" key="X"/&gt;
  &lt;key id="copy_cmd" modifiers="accel" key="C"/&gt;
  &lt;key id="paste_cmd" modifiers="accel" key="V"/&gt;
  &lt;key id="close_cmd" keycode="VK_ESCAPE" oncommand="window.close();"/&gt;
&lt;/keyset&gt;
</strong>
&lt;vbox flex="1"&gt;
 &lt;toolbox&gt;
  &lt;menubar id="findfiles-menubar"&gt;
   &lt;menu id="file-menu" label="Fichier" accesskey="f"&gt;
     &lt;menupopup id="file-popup"&gt;
       &lt;menuitem label="Ouvrir une recherche..." accesskey="o"/&gt;
       &lt;menuitem label="Sauver une recherche..." accesskey="s"/&gt;
       &lt;menuseparator/&gt;
       &lt;menuitem label="Fermer" accesskey="c" <strong>key="close_cmd"</strong>
         oncommand="window.close();"/&gt;
     &lt;/menupopup&gt;
   &lt;/menu&gt;
   &lt;menu id="edit-menu" label="Editer" accesskey="e"&gt;
     &lt;menupopup id="edit-popup"&gt;
       &lt;menuitem label="Couper" accesskey="t" <strong>key="cut_cmd"</strong>/&gt;
       &lt;menuitem label="Copier" accesskey="c" <strong>key="copy_cmd"</strong>/&gt;
       &lt;menuitem label="Coller" accesskey="p" <strong>key="paste_cmd"</strong> disabled="true"/&gt;
     &lt;/menupopup&gt;
   &lt;/menu&gt;</code></pre>

<p>
Maintenant nous pouvons utiliser ces raccourcis pour activer les commandes. Evidemment les
commandes du presse-papier ne font rien de toute façon puisque nous n'avons pas encore
écrit ces scripts.
</p>
</div>


<h2>Evènement Clavier</h2>
<p>
Il y a 3 types d'évènements clavier qui peuvent être utilisés si les dispositifs principaux décrits
ci-dessus ne sont pas appropriés.
</p>

<dl>
    <dt><code>keypress</code></dt>
    <dd>
        Appelé quand une touche est pressée puis relachée quand un élement a le focus (élément actif).
        Vous pouvez l'utiliser pour controller les caractères saisis dans un champ.
    </dd>
    <dt><code>keydown</code></dt>
    <dd> Appelé quand une touche est pressée quand un élément a le focus (élément actif). Remarquez
         que l'évènement sera appelé aussitôt la touche enfoncée, même si elle n'a pas été encore
         relachée.
    </dd>
    <dt><code>keyup</code></dt>
    <dd>Appelé quand une touche est relachée quand l'élément a le focus (élément actif).
    </dd>
</dl>

<p>
Les évènements clavier sont envoyés seulement à l'élément qui a le focus.
Typiquement, ceci inclut les champs texte, les boutons, les cases à cocher, et autres.
Si aucun des éléments n'est actif, l'évènement sera dirigé vers le document XUL lui-meme.
Dans ce cas, vous pouvez associer un scrutateur d'évènement à la balise
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/window">window</a></code>.
Cependant, si vous voulez réagir aux évènements de manière global, vous devriez utiliser un
raccourci clavier comme décrit plus haut.
</p>

<p>
L'objet évènement a 2 propriétés qui définissent la touche préssée. La propriété <code>keyCode</code>
contient le code de la touche et peut être comparé
à une des constantes de la table des codes de touche vu plus tôt dans cette section.
La propriété <code>charCode</code> est utilisée pour les caractères imprimables
et contiendra le caractère de la touche pressée.
</p>



<hr />

<p>Dans la prochaine section, nous allons découvrir comment gérer le focus et les sélections.</p>

