

<p>Un type commun de boîtes de dialogue avec lequel un utilisateur peut sélectionner un fichier
à ouvrir où à enregistrer.</p>

<h2>Sélecteurs de fichiers</h2>

<p>Un sélecteur de fichiers est une boîte dialogue qui permet à l'utilisateur de sélectionner un fichier.
Il est le plus fréquemment utilisé pour les commandes de menu Ouvrir ou Enregistrer Sous,
mais vous pouvez l'utiliser n'importe où l'utilisateur a besoin de sélectionner un fichier.
L'interface XPCOM <code>nsIFilePicker</code> est utilisé pour implémenter un sélecteur de fichiers.</p>

<p>Vous pouvez utiliser le sélecteur de fichiers dans l'un des trois modes:</p>
<ul>
<li><code>Open</code>&nbsp;: On demande à l'utilisateur de sélectionner un fichier à ouvrir.</li>
<li><code>GetFolder</code>&nbsp;: On demande à l'utilisateur de sélectionner un répertoire.</li>
<li><code>Save</code>&nbsp;: On demande à l'utilisateur de sélectionner le nom sous lequel sera sauvé le fichier.</li>
</ul>

<p>L'apparence de la boîte de dialogue sera différente pour chaque type et variera selon la plate-forme.
Une fois que l'utilisateur aura sélectionner le fichier ou le répertoire, celui-ci pourra être lu ou
enregistré.</p>

<p>L'interface du sélecteur de fichiers <code>nsIFilePicker</code> est responsable de l'affichage
de la boîte de dialogue dans l'un des trois modes.
Vous pouvez définir un certain nombre de particularités pour la boîte de dialogue en utilisant l'interface.
Quand la boîte de dialogue est fermée, vous pouvez utiliser les fonctions de l'interface pour obtenir
le fichier qui a été sélectionné.</p>

<p>Pour commencer, vous avez besoin de créer un composant du sélecteur de fichiers et l'initialiser.</p>

<pre><code>var nsIFilePicker = Components.interfaces.nsIFilePicker;
var fp = Components.classes["@mozilla.org/filepicker;1"]
        .createInstance(nsIFilePicker);
fp.init(window, "Sélectionner un fichier", nsIFilePicker.modeOpen);
</code></pre>

<p>
Tout d'abord, un nouvel objet sélecteur de fichiers est créé et stocké dans une variable <code>fp</code>.
La fonction <code>init</code> est utilisée pour initialiser le sélecteur de fichiers. Cette fonction prend
trois arguments, la fenêtre qui ouvre la boîte de dialogue, le titre de la boîte de dialogue et le mode.
Le mode ici est <var>modeOpen</var> qui est utilisé pour une boîte de dialogue Ouvrir.
Vous pouvez aussi utiliser <var>modeGetFolder</var> et <var>modeSave</var> pour les deux autres modes.
Ces modes sont des constantes de l'interface <code>nsIFilePicker</code>.</p>

<p>Il y a deux particularités que vous pouvez définir pour la boîte de dialogue avant qu'elle ne soit affichée.
La première est le répertoire par défaut qui est affiché quand la boîte de dialogue s'ouvre.
Le second est un filtre qui indique la liste des types de fichiers à afficher dans la boîte de dialogue.
On pourrait l'utiliser par exemple afin de tout cacher sauf les fichiers HTML.</p>

<p>Vous pouvez définir le répertoire par défaut en définissant la proprieté
<code>displayDirectory</code> de l'objet du sélecteur de fichiers.
Le répertoire devrait être un objet <code>nslLocalFile</code>. Si vous ne le définissez pas, un
répertoire par défaut sera sélectionné pour vous.
Pour ajouter des filtres, appelez la fonction <code>appendFilters</code> pour définir les types de fichier
que vous souhaitez voir afficher.</p>

<pre><code>
fp.appendFilters(nsIFilePicker.filterHTML | nsIFilePicker.filterImages);
fp.appendFilters(nsIFilePicker.filterText | nsIFilePicker.filterAll);
</code></pre>

<p>Le premier exemple ajoutera des filtres pour les fichiers HTML et images. L'utilisateur pourra
uniquement sélectionner ces types de fichiers. La manière de procéder est spécifique
à la plate-forme. Sur quelques plate-formes, chaque filtre sera séparé et l'utilisateur
peut choisir entre les fichiers HTML et les fichiers images. Le second exemple ajoutera des filtres
pour les fichiers textes et pour tous les fichiers.
L'utilisateur a ainsi une option pour afficher uniquement les fichiers textes ou tous les fichiers.</p>

<p>Vous pouvez aussi utilisez <var>filterXML</var> et <var>filterXUL</var> pour filtrer les fichiers
XML et XUL.
Si vous voulez filtrer des fichiers personalisés, vous pouvez utiliser la fonction <code>appendFilter</code>
 pour faire cela&nbsp;:</p>


<pre><code>
fp.appendFilter("Fichiers Audio","*.wav; *.mp3");
</code></pre>


<p>Cette ligne ajoutera un filtre pour les fichiers audios wav et MP3. Le premier argument est le titre
du type de fichier et le second est une liste de masque de fichiers séparés par un point virgule.
Vous pouvez mettre autant de motifs que vous le souhaitez.
Vous pouvez appeler <code>appendFilter</code> autant de fois que nécessaire pour ajouter les filtres supplémentaires.
L'ordre dans lequel vous les ajoutez détermine leur priorité. Habituellement, le premier ajouté est
sélectionné par défaut.</p>


<p>Enfin, vous pouvez afficher la boîte de dialogue en appelant la fonction <code>show</code>.
elle ne prend aucun arguments mais retourne un code d'état qui indique ce que l'utilisateur a sélectionné.
Remarquez que la fonction ne retourne une valeur que lorsque l'utilisateur a sélectionné un fichier.
La fonction retourne une des trois constantes&nbsp;:</p>
<ul>
<li><var>returnOK</var>&nbsp;: l'utilisateur a sélectionné un fichier et a pressé OK. Le fichier que
l'utilisateur a sélectionné sera stocké dans la propriété <code>file</code> du
sélecteur de fichiers.</li>
<li><var>returnCancel</var>&nbsp;: l'utilisateur a pressé Annuler.</li>
<li><var>returnReplace</var>&nbsp;: Dans le mode Save, cette valeur de retour signifie que l'utilisateur
a sélectionné un fichier à remplacer.
(<var>returnOK</var> sera retourné lorsque l'utilisateur aura rentré le nom d'un nouveau fichier)</li>
</ul>
<p>Vous devriez vérifier la valeur de retour et ensuite utiliser l'objet <code>file</code> du sélecteur de fichiers
en utilisant la propriété <code>file</code>.</p>

<pre><code>var res = fp.show();
if (res == nsIFilePicker.returnOK){
  var thefile = fp.file;
  // --- faire quelque chose avec le fichier ici ---
}
</code></pre>
<hr />
<p>Dans la suite, nous verrons comment créer un assistant d'installation.</p>


