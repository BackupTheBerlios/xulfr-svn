


<p>
Nous allons voir comment ajouter des gestionnaires d'évènements aux éléments XBL.
</p>

<h2>Les gestionnaires d'évènements</h2>

<p>
Comme vous pourriez le prévoir, des clics de souris, des touches pressées et d'autres évènements
sont passés à chacun des éléments à l'intérieur du contenu. Cependant, vous pourriez vouloir
maîtriser les évènements et les gérer à votre façon. Vous pouvez ajouter des gestionnaires
d'évènements aux éléments au sein du contenu si besoin. Le dernier exemple de la section précédente
le démontrait. Dans cet exemple, les gestionnaires <code class="attribut">oncommand</code> avaient été
ajoutés à quelques boutons.
</p>

<p>
Cependant, vous pouvez vouloir ajouter un gestionnaire d'évènement général au contenu, ce qui
représente tous les éléments définis au sein de la balise <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xbl/content">content</a></code>. Cela pourrait être utile pour
maîtriser les évènements de sélection (<acronym title="Note du traducteur">NdT</acronym>&nbsp;: Focus)
et de désélection. Pour définir un gestionnaire d'évènement,
utilisez l'élément <code class="tag"><a  href="http://xulfr.org/wiki/Reference/Xbl/handler">handler</a></code>.
Chacun des éléments va décrire l'action prise par un gestionnaire d'évènement simple. Vous pouvez
utiliser plus d'un gestionnaire si nécessaire. Si un évènement ne correspond pas à l'un des
évènements <code class="tag"><a  href="http://xulfr.org/wiki/Reference/Xbl/handler">handler</a></code>, il est
passé simplement dans le contenu comme d'habitude.
</p>

<p>
La syntaxe général du gestionnaire est la suivante&nbsp;:
</p>

<pre><code>
&lt;binding id="binding-name"&gt;
  &lt;handlers&gt;
    &lt;handler event="event-name" action="script"/&gt;
  &lt;/handlers&gt;
&lt;/binding&gt;
</code></pre>

<p>
Placez tous vos gestionnaires dans l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xbl/handlers">handlers</a></code>. Chaque élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xbl/handler">handler</a></code> définit l'action prise
pour un évènement particulier grâce à son attribut <code class="attribut">event</code>. Les
évènements valides sont ceux supportés par XUL et JavaScript, tels que <var>click</var> et
<var>focus</var>. Utilisez le nom de l'évènement sans son préfixe 'on'.
</p>

<p>
La principale raison pour la déclaration des gestionnaires est la modification des propriétés
personnalisées lorsqu'un évènement se produit. Par exemple, une case à cocher personnalisée pourrait
avoir une propriété <code>checked</code> qui doit être changée lorsque l'utilisateur clique dans
la case à cocher&nbsp;:
</p>

<pre><code>
&lt;handlers&gt;
  &lt;handler event="mouseup" action="this.checked=!this.checked"/&gt;
&lt;/handlers&gt;
</code></pre>

<p>
Lorsque l'utilisateur clique et relâche le bouton de la souris au dessus de la case à cocher,
l'évènement <var>mouseup</var> lui est envoyé, et le gestionnaire défini ici est appelé, entraînant
le renversement de l'état de la propriété <code>checked</code>. De façon similaire, vous pouvez souhaiter
changer une propriété lorsque l'élément est sélectionné. Vous aurez besoin d'ajouter des
gestionnaires pour ajuster les propriétés chaque fois qu'une entrée de souris ou de clavier
l'exigerait.
</p>

<p>
Pour des évènements concernant la souris, vous pouvez utiliser l'attribut <code
class="attribut">button</code> pour que le gestionnaire n'accepte que les évènements qui
correspondent à un certain bouton. Sans cet attribut, le gestionnaire gérerait tous les évènements
concernant la souris sans se soucier du bouton qui a été pressé.
L'attribut <code class="attribut">button</code> doit être
définit à <var>0</var> pour le bouton gauche de la souris, <var>1</var> pour le bouton du
milieu de la souris ou <var>2</var> pour le bouton droit de la souris.
</p>

<pre><code>
&lt;handlers&gt;
  &lt;handler event="click" button="0" action="alert('Le bouton gauche est pressé');"/&gt;
  &lt;handler event="mouseup" button="1" action="alert('Le bouton du milieu est pressé')"/&gt;

  &lt;handler event="click" button="2" action="alert('Le bouton droit est pressé');"/&gt;
&lt;/handlers&gt;
</code></pre>

<p>
Pour les évènements provenant des touches du clavier, vous pouvez utiliser un nombre d'attributs similaires à
ceux de l'élément <code class="tag"><a  href="http://xulfr.org/wiki/Reference/Xul/key">key</a></code> pour les
faire correspondre à une touche spécifique et seulement lorsque certaines
touches alternatives sont pressées. L'exemple précédent pourrait être complété de telle sorte que
la propriété <code>checked</code> de la case à cocher soit changée lorsque la barre d'espacement est pressée.
</p>

<pre><code>
&lt;handlers&gt;

  &lt;handler event="keypress" key=" " action="this.checked=!checked"/&gt;
&lt;/handlers&gt;
</code></pre>

<p>
Vous pouvez aussi utiliser l'attribut <code class="attribut">keycode</code> pour vérifier les
touches non imprimables. La section sur les
<a href="keyshort.html">raccourcis clavier</a> fournit plus
d'informations. Les touches alternatives peuvent être vérifiées en ajoutant un attribut <code
class="attribut">modifiers</code>. Il peut être définis avec l'une des valeurs ci-dessous&nbsp;:
</p>

<ul>
  <li><var>alt</var>
L'utilisateur doit presser la touche <kbd>Alt</kbd>.
  </li>
  <li><var>control</var>
L'utilisateur doit presser la touche <kbd>Control</kbd>.
  </li>
  <li><var>meta</var>
L'utilisateur doit presser la touche <kbd>Meta</kbd>.
  </li>
  <li><var>shift</var>
L'utilisateur doit presser la touche <kbd>Shift</kbd>.
  </li>
  <li><var>accel</var>
L'utilisateur doit presser la touche alernative spéciale qui est habituellement utilisée pour
les raccourcis clavier sur sa plate-forme.
  </li>
</ul>

<p>
S'il est déclaré, le gestionnaire est appelé uniquement lorsque la touche alternative est pressée. Vous
pouvez combiner plusieurs touches modificatrices en les séparant par des espaces.
</p>

<p>
La syntaxe alternative suivante peut être utilisée lorsque le code dans un gestionnaire est plus
complexe&nbsp;:
</p>

<pre><code>
&lt;binding id="binding-name"&gt;
  &lt;handlers&gt;
    &lt;handler event="event-name"&gt;
      -- le code du gestionnaire vient ici --
    &lt;/handler&gt;

  &lt;/handlers&gt;
&lt;/binding&gt;
</code></pre>

<h2>Exemple de gestionnaires</h2>

<p>
L'exemple suivant ajoute des gestionnaires de touches pour créer un presse-papier local très
primitif&nbsp;:
</p>

<p> Exemple 11.6.1&nbsp;: <a href="exemples/ex_xblevents_1.xml.txt">Source</a></p>
<pre><code>
&lt;binding id="clipbox"&gt;
  &lt;content&gt;
    &lt;xul:textbox/&gt;
  &lt;/content&gt;
  &lt;implementation&gt;
    &lt;field name="clipboard"/&gt;

  &lt;/implementation&gt;
  &lt;handlers&gt;
    &lt;handler event="keypress" key="x" modifiers="control"
      action="this.clipboard=document.getAnonymousNodes(this)[0].value;
document.getAnonymousNodes(this)[0].value='';"/&gt;
    &lt;handler event="keypress" key="c" modifiers="control"
      action="this.clipboard=document.getAnonymousNodes(this)[0].value;"/&gt;
    &lt;handler event="keypress" key="v" modifiers="control"
      action="document.getAnonymousNodes(this)[0].value=this.clipboard ? this.clipboard&nbsp;: '';"/&gt;
  &lt;/handlers&gt;

&lt;/binding&gt;
</code></pre>

<p>
Le contenu est un champ de texte simple. Un champ <code class="attribut">clipboard</code> lui a été
ajouté pour stocker le contenu du presse-papier. Cela signifie que les opérations de
presse-papier sont limitées à ce champ de texte simple. Le tampon sera propre à ce champ texte.
</p>

<p>
Trois gestionnaires ont été ajoutés, un pour couper, un pour copier et l'autre pour coller. Chacun
d'eux a sa propre combinaison de touche qui l'appelle. Le premier gestionnaire est l'opération
<em>Couper</em> et est appelé lorsque la touche <kbd>Control</kbd> est pressée suivie de la
touche <kbd>x</kbd>. Le script à
l'intérieur de l'attribut <code class="attribut">action</code> est utilisé pour couper le texte de la boîte de
texte et pour le mettre dans le champ du presse-papier. Pour faire simple, le texte entier est
coupé et pas seulement le texte sélectionné. Le code fonctionne comme suit&nbsp;:
</p>

<ol>
  <li><pre>this.clipboard=document.getAnonymousNodes(this)[0].value;</pre>
  On récupère le premier élément du tableau de contenu anonyme qui donne une référence à l'élément
<code class="tag"><a  href="http://xulfr.org/wiki/Reference/Xul/textbox">textbox</a></code>, qui s'avère être le
premier (et le seul) élément au sein de l'élément <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xbl/content">content</a></code>. On récupère la propriété <code>value</code>
qui fournira le texte du champ de saisie. Elle est ainsi assignée au champ du
presse-papier. Le résultat est que le texte qui se trouve dans la champ de texte est copié dans ce presse-papier
spécial.
  </li>
  <li><pre>document.getAnonymousNodes(this)[0].value=''</pre>
  On assigne ainsi au texte de l'élément <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/textbox">textbox</a></code> une valeur de type chaîne, vide.
Cela remplace le texte dans la champ de saisie par un espace libre.
  </li>
</ol>

<p>
Une opération de copie est similaire mais n'efface pas le texte.
Le collage est l'opération inverse si ce n'est que la valeur du champ de saisie est assignée à partir de la valeur
du champ du presse-papier. Si nous étions en train de créer une réelle implémentation de ces
raccourcis clavier de presse-papier, nous utiliserions probablement l'interface réelle du
presse-papier et gérerions également la sélection courante.
</p>

<hr />
<p>
Dans la prochaine section, nous verrons comment étendre les définitions XBL existantes.
</p>


