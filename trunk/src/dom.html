

<p>
Le Document Object Model (DOM, modèle objet d'un document) peut être utilisé pour obtenir des
informations à propos d'éléments XUL ou les modifier.
</p>

<h2>Introduction au DOM</h2>

<p>
Les éléments XUL supportent les propriétés et méthodes DOM qui vous permettront d'obtenir
des informations sur eux et de modifier n'importe quel élément. Nous ne
fournirons pas une description complète des fonctionnalités du DOM ici, mais nous
donnerons quelques exemples.
</p>

<p>
L'attribut <code class="attribut">id</code> peut être utilisé pour identifier des éléments.
Nous avons ajouté l'attribut <code class="attribut">id</code> à un certain nombre d'éléments
de notre boîte de dialogue de recherche de fichier. Par exemple, nous pouvons récupérer par
le script suivant l'état de la case à cocher pour rendre la recherche sensible à la casse&nbsp;:
</p>

<pre><code>var state = document.getElementById('casecheck').checked;</code></pre>

<p>
La valeur <var>casecheck</var> correspond à l'attribut <code class="attribut">id</code> de
la case à cocher pour la sensibilité à la casse. Une fois que nous savons si
elle est cochée ou non, nous pouvons utiliser cette indication pour effectuer la recherche. Nous pourrions
procéder de façon similaire pour l'autre case à cocher, ou n'importe quel autre élément qui
a un attribut <code class="attribut">id</code>. Nous aurons besoin de récupérer le
texte dans le champ de saisie par exemple.
</p>

<div class="task">
<p>
Ça ne sert à rien d'afficher la barre de progression et l'arbre de données vide quand la
boîte de dialogue pour la recherche de fichiers est affichée pour la première fois. Ceux-ci
ont été ajoutés de façon à ce que nous puissions les voir. Retirons les maintenant, et
affichons les lorsque le bouton Rechercher est pressé. Tout d'abord, nous devons les
rendre invisible initialement. L'attribut <code class="attribut">hidden</code>
est utilisé pour contrôler si un élément est visible ou pas.
</p>

<p>
Nous allons modifier la barre de progression de façon à ce qu'elle soit cachée à l'origine.
Nous allons aussi lui ajouter un attribut <code class="attribut">id</code> pour nous
permettre de nous y référer dans un script, pour la cacher ou l'afficher. Tant que nous
y sommes, cachons aussi le séparateur et l'arbre des résultats puisque nous n'avons
besoin d'eux qu'après avoir effectué une recherche.
</p>

<pre><code>&lt;tree <strong>id="results" hidden="true"</strong> flex="1"&gt;
  .
  .
  .

&lt;splitter <strong>id="splitbar"</strong> resizeafter="grow" <strong>hidden="true"</strong>/&gt;

&lt;hbox&gt;

  &lt;progressmeter <strong>id="progmeter"</strong> value="50%"
    style="margin: 4px;" <strong>hidden="true"</strong>/&gt;</code></pre>

<p>
Nous avons ajouté l'attribut <code class="attribut">hidden</code> et mis sa valeur à
<var>true</var>. L'élément est ainsi caché lors de sa première apparition.
</p>

<p>
Ensuite, ajoutons une fonction qui sera appelée quand le bouton Rechercher sera pressé.
Nous mettrons les scripts dans un fichier séparé findfile.js. Dans la section précédente,
nous avons ajouté l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/script">script</a></code>
dans le fichier XUL. Si vous ne l'avez pas encore fait, faites le maintenant, comme
ci-dessous. Nous ajouterons aussi un gestionnaire <code class="attribut">oncommand</code>
au bouton Rechercher.
</p>

<pre><code>&lt;script src="findfile.js"/&gt;
  .
  .
  .
&lt;button id="find-button" label="Find"
  <strong>oncommand="doFind();"</strong>/&gt;
   </code></pre>

<p>
A présent, créez un autre fichier nommé findfile.js dans le même répertoire que
findfile.xul. Nous ajouterons la fonction <code>doFind()</code> dans ce fichier.
La balise <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/script">script</a></code>
peut contenir du code directement à l'intérieur. Cependant, pour diverses raisons,
notament pour des performances supérieures, vous devriez toujours mettre vos scripts
dans des fichiers séparés, excepté pour les courts morceaux de code qui peuvent
se trouver directement dans les gestionnaires d'évènement.
</p>

<pre><code>function doFind()
{
  var meter = document.getElementById('progmeter');
  meter.hidden = false;
}</code></pre>

<p>
Cette fonction récupère d'abord une référence sur la barre de progression en
utilisant son <code class="attribut">id</code>, <var>progmeter</var>. La
seconde ligne du corps de la fonction change l'état de <code>hidden</code>
ainsi l'élément est à nouveau visible.</p>

<p>
Finalement, ajoutons une boîte de dialogue qui affiche ce que nous sommes en train
de rechercher. Evidemment nous n'en voudront pas dans la version finale, mais
rajoutons la maintenant pour nous assurer que quelque chose se produise.
</p>

<pre><code>function doFind()
{
  var meter = document.getElementById('progmeter');
  meter.hidden = false;
  <strong>var searchtext=document.getElementById('find-text').value;
  alert("Recherche de \""+searchtext+"\"");</strong>
}</code></pre>

<p>
Maintenant, avec cette boîte de dialogue ici, nous savons ce qui devrait se produire
quand nous cliquons sur le bouton Rechercher. Nous pouvons ajouter du code pour
obtenir aussi ce qui est sélectionné dans les listes déroulantes.
</p>
<p>
<a href="exemples/findfile/findfile-dom.xul.txt">Source</a>
<a href="exemples/findfile/findfile-dom.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a></p>

</div>





<h2>Créer de nouveaux éléments</h2>

<p>
Vous pouvez créer de nouveaux éléments en utilisant la fonction <code>createElement</code>
du document. Elle prend un argument, le nom de la balise représentant l'élément à créer.
Vous pouvez ensuite modifier des attributs de l'élément en utilisant la fonction
<code>setAttribute</code> et l'ajouter au document XUL en utilisant la fonction
<code>appendChild</code>. Par exemple, le code suivant va ajouter un bouton à
une fenêtre XUL&nbsp;:
</p>

<p>
Exemple 7.2.1&nbsp;: <a href="exemples/ex_7_2_1.xul.txt">Source</a>
 <a href="exemples/ex_7_2_1.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a>
</p>
<pre><code>
&lt;script&gt;
function addButton()
{
  var aBox = document.getElementById("aBox");

  var button = document.createElement("button");
  button.setAttribute("label","Un bouton");
  aBox.appendChild(button);
  window.sizeToContent();
}
&lt;/script&gt;

&lt;box id="aBox"&gt;
  &lt;button label="Ajouter" oncommand="addButton();"/&gt;
&lt;/box&gt;</code></pre>

<p>
Ce script commence par obtenir une référence sur la boîte
(<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/box">box</a></code>), qui est celle
à laquelle nous allons
ajouter un nouveau bouton. La fonction <code>createElement</code> crée un nouveau
bouton. Nous lui assignons le <code class="attribut">label</code> (l'étiquette)
<var>Un bouton</var> via la fonction <code>setAttribute</code>. La fonction
<code>appendChild</code> de la boîte (<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/box">box</a></code>)
est appelée pour ajouter le bouton à l'intérieur. Pour conclure, nous appelons
la méthode <code>sizeToContent</code> de la fenêtre
(<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/window">window</a></code>) qui
ajuste alors sa taille pour contenir le nouveau bouton.
</p>

<p>
Pour une liste plus complète des fonctions disponibles pour les éléments XUL,
reportez vous à la <a href="http://xulfr.org/wiki/Reference/Xul">référence</a>.
</p>
<hr />

<p>
Dans la prochaine section, nous découvrirons comment modifier le DOM.
</p>


