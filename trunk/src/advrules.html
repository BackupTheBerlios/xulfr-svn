

<p>
Ce paragraphe décrit la syntaxe des règles les plus complexes.
</p>

<h2>La syntaxe de règle complète</h2>

<p>
La syntaxe des règles décrites jusqu'ici est utile pour certaines sources de données,
mais l'on a parfois besoin d'afficher les données d'une manière plus sophistiquée.
La syntaxe de règle simple n'est en fait qu'un raccourci pour la syntaxe de règle complète qui est décrite ci-dessous.
Comme pour la syntaxe de règle simple, la règle complète est placée entre des balises
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/rule">rule</a></code>.
</p>

<p>
Une syntaxe de règle complète contient trois balises filles, une balise
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/conditions">conditions</a></code>
, une balise <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/bindings">bindings</a></code> et une balise
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/action">action</a></code> , bien qu'une balise
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/bindings">bindings</a></code> ne soit pas
toujours nécessaire.
</p>

<p>
L'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/conditions">conditions</a></code>
spécifie le critère qui doit correspondre à une ressource donnée. Vous pouvez spécifier le nombre de conditions,
qui doivent toutes correspondre à la ressource donnée.
En utilisant la syntaxe de règle simple, les conditions sont directement situées sur l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/rule">rule</a></code>.
</p>

<p>
Si les conditions correspondent à une ressource, le contenu placé entre les balises
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/action">action</a></code> est activé.
Dans la syntaxe de règle simple, le contenu est directement placé dans la balise
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/rule">rule</a></code>.
</p>

<h2>Conditions d'une règle</h2>

<p>
Lorsque qu'un arbre, un menu ou tout autre élément avec une source de donnée génère son contenu,
le générateur de modèle cherche en premier la ressource marquée par l'attribut <code class="attribut">ref</code>.
L'opération est ensuite répétée pour l'ensemble des ressources filles.
Il compare chaque ressource aux conditions. Si celles-ci sont vérifiées,
le contenu de l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/action">action</a></code>
est généré pour cette ressource. Si elles ne sont pas vérifiées, rien n'est généré.
</p>

<p>
L'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/conditions">conditions</a></code>
contient trois sous éléments.
Le premier est l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/content">content</a></code>
qui doit toujours être présent une fois seulement.
Il sert de marqueur lorsque le générateur de modèle parcourt les ressources.
Il indique le nom de la variable dans laquelle est placée une référence à la ressource racine pendant que
les conditions sont analysées.
La ressource racine est celle indiquée par l'attribut <code class="attribut">ref</code> dans l'élément
contenant le modèle.
</p>

<p>
La syntaxe d'un élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/content">content</a></code>
est la suivante&nbsp;:
</p>


<pre><code>&lt;content uri="?var"/&gt;</code></pre>



<p>
La point d'interrogation indique que le texte qui suit est une variable. Vous pouvez alors utiliser
la variable <code>var</code> dans le reste des conditions.
Bien entendu, vous pouvez appeler la variable comme vous le voulez.
</p>

<p>
L'élément suivant est l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/member">member</a></code>,
 qui est utilisé pour parcourir un ensemble de ressources filles.
En termes RDF, c'est comparable à <code class="tag">Seq</code>, <code class="tag">Bag</code> ou <code class="tag">Alt</code>.
Disons que vous avez une liste de villes comme dans le code RDF/XML suivant&nbsp;:
</p>


<pre><code>&lt;RDF:Seq RDF:about="http://www.xulplanet.com/rdf/weather/cities"&gt;
  &lt;RDF:li RDF:resource="http://www.xulplanet.com/rdf/weather/city/paris"/&gt;
  &lt;RDF:li RDF:resource="http://www.xulplanet.com/rdf/weather/city/Manchester"/&gt;
  &lt;RDF:li RDF:resource="http://www.xulplanet.com/rdf/weather/city/Melbourne"/&gt;
  &lt;RDF:li RDF:resource="http://www.xulplanet.com/rdf/weather/city/Kiev"/&gt;
&lt;/RDF:Seq&gt;

&lt;RDF:Description RDF:about="http://www.xulplanet.com/rdf/weather/city/paris"&gt;
  &lt;cityset:name&gt;paris&lt;/cityset:name&gt;
&lt;/RDF:Description&gt;

.
.
.</code></pre>



<p>
Vous voulez afficher une ligne dans une arborescence pour chaque ville.
Pour accomplir cela, utilisez l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/member">member</a></code> comme ceci&nbsp;:
</p>


<pre><code>&lt;tree id="citiesTree" datasources="weather.rdf"
      ref="http://www.xulplanet.com/rdf/weather/cities">
  &lt;template&gt;
    &lt;rule&gt;
      &lt;conditions&gt;
        &lt;content uri="?list"/&gt;
        &lt;member container="?list" child="?city"/&gt;
      &lt;/conditions&gt;
    &lt;rule&gt;
  &lt;template&gt;
&lt;/tree&gt;</code></pre>



<p>
Le générateur de modèle commence par récupérer la valeur de l'attribut <code class="attribut">ref</code>,
qui dans ce cas est <var>http://www.xulplanet.com/rdf/weather/cities</var>.
Cette ressource va être mise dans la variable <code>list</code> comme il est indiqué par la balise
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/content">content</a></code>.
On peut alors obtenir les ressources associées à la ressource racine en utilisant la variable <code>list</code>.
</p>

<p>
Le générateur de modèle s'intéresse ensuite à l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/member">member</a></code>.
Cela force le générateur à itérer sur les fils d'un élément.
Le parent est indiqué par l'attribut <code class="attribut">container</code> et les fils par
l'attribut <code class="attribut">child</code>.
Dans l'exemple ci-dessus, la valeur de l'attribut <code class="attribut">container</code> est la variable
<code>list</code>.
Ainsi le parent sera la valeur de la variable <code>list</code>, qui a la valeur de la ressource racine
<var>http://www.xulplanet.com/rdf/weather/cities</var>.
L'effet induit va être de parcourir à travers la liste des fils de
'http://www.xulplanet.com/rdf/weather/cities'.
</p>

<p>
Si vous regardez en détail le RDF ci-dessus, la ressource 'http://www.xulplanet.com/rdf/weather/cities' a
quatre filles, une pour chaque ville.
Le générateur de modèle parcourt chacune d'elle, comparant la fille avec la valeur de l'attribut
<code class="attribut">child</code>.
Dans le cas présent, celui-ci contient la valeur <var>city</var>. Donc le générateur va donner à la variable
<code>city</code> la valeur des ressources filles au fur et à mesure.
</p>

<p>
Comme il n'y a pas d'autres conditions, la condition correspond à chacun des quatre ressources et le générateur
va créer du contenu pour chacune des quatre. Bien sûr, l'exemple ci-dessus n'a aucun contenu. On l'ajoutera
par la suite.
</p>

<p>
L'élément suivant est l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/triple">triple</a></code>.
Il est utilisé pour vérifier l'existence d'un triplet (ou assertion) dans la source de donnée du RDF.
Un triplet est comme la propriété d'une ressource. Par exemple, un triplet existe entre un marque-page et son URL associée.
Cela peut-être exprimé ainsi :
</p>

<pre>Un marque-page vers mozilla.org  -&gt;  URL  -&gt;  www.mozilla.org</pre>

<p>
Cela signifie qu'il existe un triplet entre le marque-page <var>Un marque-page vers mozilla.org</var> et
<var>www.mozilla.org</var> par la propriété <code>URL</code>.
La première partie est appelée le sujet, la seconde, le prédicat, et la dernière, l'objet.
Exprimé en tant qu'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/triple">triple</a></code>,
il serait ainsi&nbsp;:
</p>

<pre><code>&lt;triple subject="Un marque-page vers mozilla.org"
           predicate="URL"
           object="www.mozilla.org"/&gt;</code></pre>

<p>
Cela a été un peu simplifié par rapport au code réel. Le prédicat devrait normalement inclure les espaces de
nom (namespace), et le sujet devrait être l'identifiant ressource du marque-page, et non pas le titre du marque-page
comme ici. En fait, le titre du marque-page devrait être un autre triplet dans la source de donnée qui utiliserait le
prédicat 'nom'.
</p>

<p>
Vous pouvez remplacer le sujet et l'objet dans l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/triple">triple</a></code>
avec des références aux variables, auquel cas les valeurs seront substituées aux variables.
Si aucune valeur n'est définie pour une variable, le générateur de modèle va attribuer la valeur de
la source de donnée à la variable.
</p>

<p>
Disons par exemple, que l'on veuille ajouter une prédiction météo à la source de données des villes.
Les conditions suivantes peuvent être utilisées :
</p>


<pre><code>&lt;conditions&gt;
  &lt;content uri="?list"/&gt;
  &lt;member container="?list" child="?city"/&gt;
  &lt;triple subject="?city"
             predicate="http://www.xulplanet.com/rdf/weather#prediction"
             object="?pred"/&gt;
&lt;/conditions&gt;</code></pre>



<p>
Le générateur de modèle va parcourir chaque ville comme précédemment.
Lorsqu'il va en arriver au triplet, il va s'intéresser aux assertions de la source de données RDF pour
une prédiction météo.
On attribue à la variable <var>pred</var> la prédiction météo.
Le générateur va répéter cette opération pour chacun des quatre villes.
Une comparaison a lieu et le générateur va crée du contenu pour chaque ville qui a une prédiction météo associée.
Si la ville n'a pas de ressource de prédiction, la condition ne correspond pas et aucun contenu ne sera
crée pour cette ville.
Remarquez que vous n'avez pas besoin de mettre 'rdf:' au début du prédicat, ceci est sous-entendu.
</p>

<p>
On peut aussi remplacer l'attribut <code class="attribut">object</code> avec une valeur statique.
par exemple&nbsp;:
</p>


<pre><code>&lt;conditions&gt;
  &lt;content uri="?city"/&gt;
  &lt;triple subject="?city"
             predicate="http://www.xulplanet.com/rdf/weather#prediction"
             object="Nuageux"/&gt;
&lt;/conditions&gt;</code></pre>



<p>
Cet exemple est similaire mais nous spécifions que nous voulons une comparaison qui s'effectue sur <var>Nuageux</var>.
Le résultat obtenu est que la condition ne va s'appliquer que pour les villes dont la prédiction météo est <var>Nuageux</var>.
</p>

<p>
On peut ajouter davantage de triplet pour réaliser plus de comparaisons. par exemple,
dans l'exemple ci-dessus, on peut également vouloir vérifier la température et la vitesse du vent.
Pour cela, il suffit d'ajouter un autre triplet qui vérifiera les ressources supplémentaires.
La condition va correspondre si et seulement si l'intégralité des triplets retournent des valeurs.
</p>

<p>
L'exemple ci-dessous va vérifier un triplet supplémentaire concernant le nom de la ville.
Il lui sera attribué une variable <code>name</code>. La condition va correspondre si la ville a
à la fois un nom et une prédiction météo.
</p>


<pre><code>&lt;conditions&gt;
  &lt;content uri="?list"/&gt;
  &lt;member container="?list" child="?city"/&gt;
  &lt;triple subject="?city"
             predicate="http://www.xulplanet.com/rdf/weather#name"
             object="?name"/&gt;
  &lt;triple subject="?city"
             predicate="http://www.xulplanet.com/rdf/weather#prediction"
             object="?pred"/&gt;
&lt;/conditions&gt;</code></pre>



<h2>Générer du contenu</h2>

<p>
Le contenu à générer pour une règle est spécifié dans l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/action">action</a></code>.
Cela peut être le contenu des lignes d'un arbre, les items de menu ou quoi que vous vouliez générer.
A l'intérieur du contenu, vous pouvez vous référer aux variables qui ont été définies dans les conditions.
Ainsi, dans l'exemple météo ci-dessus, vous pouvez utiliser les variables <code>name</code> ou <code>pred</code>
 pour afficher la ville ou la prédiction météo.
Vous pouvez aussi utiliser les variables <code>list</code> ou <code>city</code> mais elles contiennent des
ressources et non du texte, donc elles n'auront pas de sens pour les utilisateurs.
</p>

<p>
Dans la syntaxe de règle simple, on utilise la syntaxe <code class="attribut">uri="rdf:*"</code>
pour indiquer l'emplacement où le contenu doit être généré.
Dans la syntaxe de règle complète, on donne la valeur de l'attribut <code class="attribut">uri</code>
à une variable que l'on a utilisé dans les conditions.
Normalement, ce sera la variable assignée à l'attribut <code class="attribut">child</code> de l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/member">member</a></code>.
</p>

<p>
L'exemple suivant montre un arbre complet avec des conditions et une action.
Vous pouvez consulter le fichier RDF séparément ( <a href="exemples/weather.txt">Source</a>
<a href="exemples/weather.rdf">RDF</a>).
</p>


<p>Exemple 9.5.1&nbsp;
<a href="exemples/ex_advrules_1.xul.txt">Source</a>
<a href="exemples/ex_advrules_1.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a>
:</p>

<pre><code>&lt;tree id="weatherTree" flex="1" datasources="weather.rdf"
      ref="http://www.xulplanet.com/rdf/weather/cities"&gt;
  &lt;treecols&gt;
    &lt;treecol id="city" label="Ville" primary="true" flex="1"/&gt;
    &lt;treecol id="pred" label="Prédiction Météo" flex="1"/&gt;
  &lt;/treecols&gt;

  &lt;template&gt;
    &lt;rule&gt;
      &lt;conditions&gt;
        &lt;content uri="?list"/&gt;
        &lt;member container="?list" child="?city"/&gt;
        &lt;triple subject="?city"
                predicate="http://www.xulplanet.com/rdf/weather#name"
                object="?name"/&gt;
        &lt;triple subject="?city"
                predicate="http://www.xulplanet.com/rdf/weather#prediction"
                object="?pred"/&gt;
      &lt;/conditions&gt;
      &lt;action&gt;
        &lt;treechildren&gt;
          &lt;treeitem uri="?city"&gt;
            &lt;treerow&gt;
              &lt;treecell label="?name"/&gt;
              &lt;treecell label="?pred"/&gt;
            &lt;/treerow&gt;
          &lt;/treeitem&gt;
        &lt;/treechildren&gt;
      &lt;/action&gt;
    &lt;/rule&gt;
  &lt;/template&gt;
&lt;/tree&gt;</code></pre>



<p>
Deux colonnes apparaissent dans cet arbre, l'une qui affiche la valeur de "nom" pour chacun ligne,
et l'autre qui affiche le résultat de la prédiction météo.
</p>

<p class="note">
Si vous utilisez le marqueur <var>dont-build-content</var> (ne-pas-générer-de-contenu) sur un arbre,
remplacez l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/content">content</a></code>
par un élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/treeitem">treeitem</a></code>
</p>

<h2>Ajouter des liens supplémentaires</h2>

<p>
Le dernier élément que vous pouvez ajouter à l'intérieur d'une règle est l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/bindings">bindings</a></code>.
À l'intérieur de celui-ci, vous pouvez mettre un ou plusieurs élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/binding">binding</a></code>.
Un lien dans une règle a la même syntaxe qu'un triplet et remplit quasiment la même fonction.
Par exemple, dans l'exemple météo précédent, on peut ajouter le lien suivant&nbsp;:
</p>


<pre><code>&lt;bindings&gt;
  &lt;binding subject="?city"
             predicate="http://www.xulplanet.com/rdf/weather#temperature"
             object="?temp"/&gt;
&lt;/bindings&gt;</code></pre>

<p>
Le lien va prendre la ressource "température" de chaque ville et l'attribuer à la variable <code>temp</code>.
C'est tout à fait similaire à ce qu'un triplet accomplit.
La différence se situe dans le fait qu'un lien n'est pas examiné lorsque quand les conditions sont vérifiées.
Cela veut dire que chaque ville doit avoir un nom et une prédiction météo associée pour être affichée,
mais cela n'a aucune importance si elle n'a pas de température.
Cependant, si elle en a une, la valeur sera attribuée à la variable <code>temp</code> afin qu'elle soit utilisée
dans une action. Si une ville n'a pas de température, la variable <code>temp</code> sera une chaîne de caractère vide.
</p>
<hr />
<p>
Par la suite, nous verrons comment sauver les états des éléments XUL.
</p>

