

<p>La boîte de dialogue de recherche de fichiers est tout à fait correcte à ce stade. Nous
ne l'avons pas beaucoup optimisé mais nous avons créé une interface utilisateur
facilement. Dans ce qui suit, nous allons montrer comment lui ajouter des
scripts.</p>

<h2>Utiliser les scripts</h2>

<p>Pour rendre le dialogue de recherche de fichiers fonctionnelle, nous avons
besoin d'ajouter des scripts qui vont s'exécuter quand l'utilisateur interagira
avec le dialogue. Nous voudrions ajouter un script pour gérer le bouton
Rechercher, le bouton Annuler et pour gérer chaque commande du menu. Nous
écrirons ces scripts en utilisant des fonctions Javascript de la même manière qu'en
HTML.</p>

<p>Vous pouvez utiliser l'élément <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/script">script</a></code> pour inclure
des scripts dans des fichiers XUL. Vous pouvez aussi inclure le script
directement dans le fichier XUL entre les balises <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/script">script</a></code> ouvrante et
fermante, mais il est préférable de placer le code dans un fichier à part. Votre
fenêtre XUL se chargera un peu plus rapidement. Nous utiliserons alors l'attribut <code
class="attribut">src</code> pour lier un fichier de script externe.</p>

<div class="task">
<p>Ajoutons un script au dialogue de recherche de fichiers. Bien que le nom du
fichier de script n'ait pas d'importance, on lui donne habituellement le même
nom que celui du fichier XUL, avec l'extension js. Dans ce cas, on utilisera
findfile.js. Ajoutez la ligne ci-dessous juste après la balise <code
class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/window">window</a></code> ouvrante et
avant tout autre élément.</p>

<pre><code><strong>&lt;script src="findfile.js"/&gt;
</strong></code></pre>

<p>Nous créerons le fichier de script plus tard, quand nous saurons quoi y
mettre. Nous allons définir des fonctions dans le fichier, que nous pourrons
appeler dans les gestionnaires d'évènements.</p>
</div>

<p><code>oncommand</code> est le gestionnaire d'évènement que vous utiliserez généralement
pour réagir aux évènements liés aux boutons et aux menus. Vous pouvez y mettre
du code qui sera exécuté quand l'utilisateur clique sur un élément, ou l'active
avec le clavier.</p>

<div class="task">
<p>Un gestionnaire <code>oncommand</code> peut être placé sur les boutons Rechercher et
Annuler dans le dialogue de recherche de fichiers. Cliquer sur le bouton
Rechercher devrait démarrer la recherche. Comme nous n'implémenterons pas cette
partie, nous l'omettrons. Par contre, cliquer sur le bouton Annuler devrait
fermer la fenêtre. Le code ci-dessous montre comment faire cela. Tant que nous y
sommes, ajoutons le même code à l'item de menu Fermer.</p>

<pre><code>&lt;menuitem label="Fermer" accesskey="f" <strong>oncommand="window.close();"</strong>/&gt;
...

&lt;button id="cancel-button" label="Annuler"
    <strong>oncommand="window.close();"</strong>/&gt;
</code></pre>

<p>Deux gestionnaires ont été ajoutés ici. Le gestionnaire oncommand a été
ajouté à l'item de menu Fermer. En utilisant ce gestionnaire, l'utilisateur
pourra fermer la fenêtre en cliquant sur l'item de menu ou en le sélectionnant
avec le clavier. Le gestionnaire oncommand a été ajouté au bouton Annuler.</p>
</div>

<p>De manière similaire, nous pouvons réagir aux autres évènements de la souris
et aux appuis de touches du clavier en utilisant les gestionnaires d'évènements
de la souris et des touches. Si vous ne spécifiez pas de gestionnaire
d'évènement pour un évènement particulier, l'élément le gèrera lui-même. C'est
généralement ce que vous voulez qu'il se produise. La plupart des élément XUL
auront leurs propres réactions aux évènements de la souris et du clavier. Par
exemple, les menuitems réagiront à leurs touches d'accès et des popups
apparaîtront au bon moment.</p>

<h2>Modèle d'évènement</h2>

<p>XUL utilise le même modèle d'évènement que décrit dans les <a
href="http://www.w3.org/TR/2000/REC-DOM-Level-2-Events-20001113/">Évènements
DOM2</a>. Brièvement, un évènement est envoyé en deux phases. Dans la phase de
capture, un évènement comme un clic de la souris est d'abord envoyé au document
puis descend dans la hiérarchie des éléments jusqu'à atteindre l'élément qui a
déclenché l'évènement. La phase inverse (phase de "bubbling") intervient alors.
L'évènement est renvoyé vers le haut de la hiérarchie tour à tour à chaque
élément.</p>

<p>Sur son chemin, si l'évènement est géré par un élément, le traitement de
l'élément s'arrête. Si cet élément ne gère pas l'évènement, cela continue avec
le prochain élément, jusqu'à ce qu'un le gère. Si rien ne gère l'évènement, un
traitement par défaut est effectué.</p>

<p>Cela signifie que vous n'êtes pas obligé de mettre le gestionnaire
d'évènement sur l'élément sur lequel vous voulez réagir à l'évènement. Vous
pouvez aussi le mettre sur n'importe quel élément parent au-dessus de l'élément.
Par exemple, au lieu de mettre le gestionnaire d'évènement sur le <code
class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/menuitem">menuitem</a></code>, vous
pourriez le mettre sur l'élément <code class="tag">menu</code>.</p>

<p>Un gestionnaire doit renvoyer <var>true</var> si l'élément a été géré ou
<var>false</var> s'il n'a pas été géré. En renvoyant <var>false</var>, vous pouvez faire
quelque chose mais le traitement par défaut sera effectué. Ce processus est
similaire à la gestion des évènements HTML.</p>

<p>Vous pouvez obtenir l'élément à l'origine de l'évènement grâce à la propriété
<code class="attribut">target</code> de l'objet
<code>event</code>. Par exemple, si vous ajoutez le gestionnaire
d'évènement suivant à un élément <code class="tag">window</code>, une boîte d'alerte apparaîtra quand vous
cliquerez sur un élément de la fenêtre. L'alerte affichera l'élément sur lequel
vous avez cliqué.</p>

<pre><code>&lt;window
    onclick="alert(event.target.tagName); return false;"
    .
    .
    .
&gt;
</code></pre>

<p>Vous pouvez aussi ajouter des gestionnaires d'évènements dynamiquement en
utilisant la fonction addEventListener. Vous pouvez l'utiliser pour tout type
d'élément et d'évènement. Elle prend trois paramètres : le type d'évènement, une
fonction à exécuter quand l'évènement arrive et un booléen indiquant s'il faut
capturer ou non.</p>

<hr />

<p>Dans la prochaine section, nous allons voir plus de détails à propos de l'objet
<code>event</code>.</p>

<p>Le dialogue de recherche de fichiers à ce stade : <a
href="exemples/findfile/findfile-events.xul.txt">Source</a>
<a
href="exemples/findfile/findfile-events.xul"
onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a></p>


