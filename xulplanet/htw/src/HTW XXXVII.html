
<p>Le troisième type d'observateur invoqué dans un constructeur de gabarits est un <a href="http://www.xulplanet.com/references/xpcomref/ifaces/nsIRDFObserver.html">nsIRDFObserver</a>. Le constructeur de gabarits implémente cette interface pour surveiller toutes modifications RDF. Lorsqu'elle est modifiée, la source de données va notifier tous les observateurs de cette modification. Le constructeur de gabarits utilise ces notifications pour mettre à jour le gabarit si nécessaire en fonction des informations nouvelles ou supprimées. Vous n'avez pas besoin d'implémenter cet observateur vous même, bien que vous pouvez ajouter un observateur à la source de données si vous désirez être notifié d'éventuelles modifications de données.</p>

<p>Il existe deux situations principales déclenchant les notifications. La première se produit lorsque les fonctions de modifications de la source de données sont appelées. Il existe quatre de ces fonctions&nbsp;: '<code>Assert</code>' pour ajouter un nouveau triplet (ou arc) au graphe RDF, '<code>Unassert</code>' pour supprimer un triplet, '<code>Change</code>' pour ajuster la cible d'un triplet, et '<code>Move</code>' pour ajuster la source d'un triplet. Dans le cas des sources de données de Mozilla, l'avant dernière fonction réalise une suppression de l'ancien triplet et un ajout du nouveau, en créant ainsi l'effet de modification de valeur. Cependant, une seule notification est lancée.</p>

<p>Par exemple, l'appel de la fonction <code>Assert</code> ressemble à ceci&nbsp;:</p>

<pre><code>var source = RDF.GetResource("http://www.xulplanet.com/ndeakin/images/t/obelisk.jpg");
var predicate = RDF.GetResource("http://purl.org/dc/elements/1.1/description");
var target = RDF.GetLiteral("Un sur la trentaine ou plus d'obélisques égyptiens");
datasource.Assert(source, predicate, target, true);</code></pre>

<p>L'appel de la fonction <code>Assert</code> ajoute un nouveau triplet à la source de données RDF. Lorsque cet ajout se produit, tous les gabarits observant la source de données seront notifiés via la méthode <code>onAssert</code> de l'observateur RDF.</p>

<p>La seconde situation déclenchant les notifications survient lorsque la source de données est en train de se charger ou de se recharger. En réalité, en interne, ces notifications ne sont pas vraiment différentes des autres, mais elles valent la peine d'en discuter séparément. Lorsque le processeur RDF charge le RDF/XML, il appelle la fonction <code>Assert</code> de l'objet <code>datasource</code> pour ajouter chaque triplet trouvé. En effet, cela revient au même résultat que d'ajouter vous même chaque série de triplets en utilisant la méthode <code>Assert</code>.</p>

<p>Lors du rechargement de la source de données, vous pourriez penser que le processeur RDF supprime toutes les données existantes, recharge les nouvelles données, et les ajoute à la source de données. Vous pourriez également penser qu'il crée une source de données rafraîchie avec les nouvelles données. En réalité, le processeur RDF réalise quelque chose de plus subtil. Lors du rechargement de la source de données, il conserve les triplets RDF existants intacts, et ne modifie que les données qui ont changé. Lors du traitement, tous les triplets existants ne sont pas ajoutés de nouveau. Si un triplet n'existait pas, il est ajouté. Tous les triplets qui n'existent plus avec les nouvelles données sont supprimés. En clair, l'observateur sera appelé pour tous les triplets qui diffèrent entre les anciennes données et les nouvelles. Si la source de données rechargée n'a pas été modifiée, le constructeur ne recevra aucune notification. Ce mode de fonctionnement est optimisé.</p>

<p>L'observateur RDF a également deux méthodes <code>onBeginUpdateBatch</code> et <code>onEndUpdateBatch</code>. Elles sont appelées lors de la réalisation de nombreuses opérations sur la source de données. Lorsque la source de données est modifiée, les modifications sont pratiquées du début à la fin. Ensuite, plutôt qu'une notification soit lancée à chaque modification, la source de données enverra une seule notification globale indiquant la fin des changements. Le constructeur de gabarits peut alors reconstruire entièrement le gabarit. Ce fonctionnement est très utile dans le cas de très nombreuses modifications pour éviter de devoir recalculer trop rapidement des parties du gabarit.</p>

<p>Nous verrons ensuite d'autres spécificités sur la façon dont le constructeur de gabarits gère les modifications suivantes.</p>
