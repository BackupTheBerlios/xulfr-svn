
<p>Les gabarits sont apparemment difficilement compréhensibles pour beaucoup de gens, et malheureusement, il y a beaucoup de choses à apprendre pour les utiliser&nbsp;: RDF, la syntaxe de requête, et des fonctionnalités XUL supplémentaires. Le manque de messages d'erreurs ou de journal d'enregistrement rend les choses doublement difficiles.</p>

<p>Pour commencer, un gabarit XUL est une sorte de production de blocs de contenu pour chaque résultat issue d'une requête ou assimilée. Les résultats d'une requêtes de base de données en sont une bonne analogie. Pour chaque résultat retourné par la requête, un contenu est généré. La syntaxe des gabarits permet pour différentes règles de générer différents contenus basés sur des critères particuliers, comme définir des valeurs d'attributs à partir des résultats retournés. D'autres systèmes appellent cela la liaison de données (<abbr title="Note du Traducteur">NdT</abbr>&nbsp;: databinding). Effectivement, les gabarits XUL sont le moyen pour XUL de faire de la liaison de données. Cependant, il y a deux restrictions avec un gabarit. Premièrement, vous ne pouvez générer du contenu qu'à partir des résultats d'une requête. Vous ne pouvez pas simplement obtenir une donnée isolée et l'assigner à un attribut, puisque les gabarits sont conçus pour des blocs de données répétitifs. Deuxièmement, vous pouvez utiliser uniquement les sources de données RDF. Ces restrictions devraient disparaître dans le futur.</p>

<p>En XUL, la source de données RDF est spécifiée en plaçant l'attribut <code class="attribut">datasources</code> sur un élément. Quand l'interpréteur XUL voit un élément avec cet attribut, il instancie un constructeur de gabarit et l'attache à l'élément. Il s'attend à ce qu'il y ait un <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/template">template</a></code> à l'intérieur de l'élément. Le constructeur de gabarit charge la source de données, exécute la requête, et génère le contenu pour chaque résultat. Le contenu est inséré dans le contenu XUL comme si vous l'aviez placé vous même. Voici un exemple&nbsp;:</p>

<pre><code>&lt;vbox datasources="http://www.xulplanet.com/ds/sample.rdf"&gt;</code></pre>

<p>Cet exemple spécifie la source de donnée&nbsp;: <var>http://www.xulplanet.com/ds/sample.rdf</var>.</p>

<p>Le constructeur de gabarit charge la source de données en utilisant le service RDF de la même façon que si vous aviez créé la source de données directement à travers le service RDF. La source de données est chargée via son URL. Certaines sources de données RDF sont fournies avec Mozilla (leurs URL commencent par <var>rdf:</var>). Elles sont cependant chargées comme n'importe quelle autre URL. Si la source de données est déjà chargée et se trouve déjà dans le cache, le constructeur de gabarit peut commencer le travail. Sinon, il attend jusqu'à ce que les données soient chargées. En réalité, ce n'est pas exactement vrai. Le service RDF commencent à charger la source de données en tâche de fond, et le constructeur de gabarit commence tout de même le processus de construction. Naturellement, tant qu'il n'y a pas encore de données, aucun résultat ne sera disponible, donc le constructeur ne génère rien.</p>

<p>Dés que des données commencent à arriver, le constructeur de gabarit scanne les informations pour voir si des résultats peuvent être créés. Si c'est le cas, il génère du contenu. Sinon, rien n'est généré pour l'instant. Une chose intéressante à noter est que, du fait de la nature du processus d'analyse du RDF, le constructeur génère les résultats et construit le contenu incrémentalement, pendant que les données arrivent. Bien sûr, comme les données arrivent trop vite depuis partir le réseau, vous ne vous en rendez pas vraiment compte. Si la source de données est déjà chargée, le constructeur génère le contenu en une seule étape, bien que cela ne soit pas entièrement vrai comme nous le verrons plus tard.</p>

<p>Le constructeur de gabarit peut aussi utiliser de multiple sources de données qui sont combinées entre elles en une seule source de données, comme si elles étaient à l'origine dans la même source de données. Un objet d'interface <code>nsIRDFCompositeDataSource</code> est utilisé pour cet usage. Vous pouvez avoir cette source de données composite dans un script en utilisant la propriété <code>database</code> de l'élément, si vous voulez ajouter ou enlever des sources de données.</p>

<p>Comme il a été mentionné, le constructeur de gabarit charge les sources de données en passant les URLs au service RDF. Cependant, une URL spéciale, <var>rdf:null</var>, est utilisée pour indiquer que vous n'avez pas de sources de données, ou alors indiquer une source de données vide. Une source de données composite sera tout de même créée, mais aucune source de données ne sera ajoutée. Cette utilisation peut servir à spécifier une source de données dynamiquement avec un script.</p>

<p>De plus, pour les fichiers XUL du chrome (comme les extensions), la source de données <var>rdf:local-store</var> est toujours incluse dans le composite. Le "stockage local" (<abbr title="Note du Traducteur">NdT</abbr>&nbsp;: local-store), est une source de données qui est habituellement utilisée pour stocker les informations d'états, comme les tailles des fenêtres, la liste des colonnes affichées dans un arbre, ou la liste des items ouverts dans un arbre. Vous pouvez effectuer une requête sur n'importe quelles données du stockage local depuis un gabarit, bien que cela soit rarement le cas.</p>

<p>Quand de multiples sources de données sont utilisées, le RDF est combiné comme si c'était une grande source de données. Cela signifie qu'une requête de gabarit peut récupérer les données de n'importe quelle de ces sources de données. Cette combinaison est souvent appelée "agrégation". Elle peut être une fonctionnalité intéressante et qui fonctionne indépendamment de la source de données. Par exemple, vous pourriez utiliser la source de données interne des marque-pages qui contient les marque-pages de l'utilisateur, et utiliser votre propre source de données pour ajouter des données personnalisées à ces marque-pages.</p>

<pre><code>&lt;vbox datasources="rdf:bookmarks http://www.xulplanet.com/ds/sample.rdf"&gt;</code></pre>

<h3>RDF</h3>

<p>RDF est, en termes mathématiques, un graphe orienté étiqueté. Cela signifie que RDF est un graphe de sommets séparés par des arcs, et que chaque sommet et arc possèdent une étiquette. Puisqu'il s'agit d'un graphe, les arcs peuvent pointer vers n'importe quel endroit et les sommets peuvent avoir un certain nombre d'arcs pointant vers eux ou à partir d'eux. Et aussi parce que c'est un graphe, il n'y a pas de réel point de départ ou de sommet racine, donc vous pouvez partir de n'importe où. Dans l'image ci-dessous, vous pouvez voir que le sommet A, en haut, a des arcs pointant sur B, C et D. De même, C a un arc pointant sur D. Vous pouvez avoir des arcs pointant n'importe où, par exemple le sommet D peut avoir un arc pointant à son tour vers A. Pour parcourir le graphe, vous pouvez démarrer au sommet A et parcourir le graphe en suivant les arcs de B, C ou D. Ou bien vous pouvez démarrer sur B et aller jusqu'à A, puis aller jusqu'à C et D. Il n'existe pas d'obligation à suivre les arcs dans la direction qu'ils pointent&nbsp;; vous pouvez aisément aller dans l'autre sens. Cette image a été générée à partir du validateur RDF du W3C, un bon endroit pour vérifier si votre RDF est valide.</p>

<img src="images/template-guide-p2.png" class="screenshot" alt="graphe RDF" />

<p>Les textes en rouge sont les étiquettes pour les arcs, nommées attributs. Dans cet exemple, toutes les arcs ont la même étiquette. D'ordinaire, ce n'est pas le cas. Les gabarits fournissent une manière de parcourir en utilisant uniquement les arcs avec des étiquettes spécifiques. Voici le RDF/XML adapté à ce graphe&nbsp;:</p>

<pre><code>&lt;?xml version="1.0"?&gt;
&lt;rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
         xmlns:rel="http://www.xulplanet.com/rdf/"&gt;
  &lt;rdf:Description rdf:about="http://www.xulplanet.com/rdf/A"&gt;
    &lt;rel:relatedItem rdf:resource="http://www.xulplanet.com/rdf/B"/&gt;
    &lt;rel:relatedItem rdf:resource="http://www.xulplanet.com/rdf/C"/&gt;
    &lt;rel:relatedItem rdf:resource="http://www.xulplanet.com/rdf/D"/&gt;
  &lt;/rdf:Description&gt;
  &lt;rdf:Description rdf:about="http://www.xulplanet.com/rdf/C"&gt;
    &lt;rel:relatedItem rdf:resource="http://www.xulplanet.com/rdf/D"/&gt;
  &lt;/rdf:Description&gt;
&lt;/rdf:RDF&gt;</code></pre>

<p>Pour une requête sur un gabarit XUL, vous avez d'abord besoin de sélectionner un point de départ dans le graphe RDF.
 Une fois que vous avez sélectionné un point de départ, vous utilisez un nombre d'états qui indiquent où aller ensuite
 lorsque le graphe est parcouru. Finalement, vous conclurez avec un lot de sommets que vous considérez comme les
 terminus de votre requête. Ils deviennent vos résultats et du contenu sera généré pour chacun de ces résultats.
 Disons que vous partez de A. Vous pouvez naviguer jusqu'à B, C et D et générer trois blocs de sortie. Ou bien vous
 pouvez commencer sur D et remonter deux arcs. Cela produira deux résultats, A et B. Regardez le graphe pour voir
 si vous pouvez comprendre pourquoi deux résultats seront générés dans ce cas.</p>

<p>Dans la terminologie des gabarits XUL, le point de départ est appelé le conteneur ou le point de référence,
 et le terminus est appelé le membre. Il est nommé ainsi parce qu'il sert habituellement à rassembler la liste des membres,
 ou fils, d'un conteneur. Mais ce n'est pas nécessairement le cas. Tout peut être point de départ ou de fin.</p>

<p>En RDF, Les sommets sont identifiés par une chaîne de caractères. Il y a deux types de sommets en RDF, les ressources
 qui représentent en général des "choses", et les littéraux qui sont des valeurs telles que les noms des choses, les
 dates des choses, les tailles des choses, et ainsi de suite. Une valeur de littéral est, par exemple, le nom de
 la chose, tel que "Fred". Une valeur de ressource est un URI inventé pour votre propre donnée RDF.
 Nous utiliserons l'URI des sommets ressources dans un gabarit. Dans l'image, les URIs des ressource sont les étiquettes
 bleues de chaque sommet. Il n'y a pas de littéraux dans cet exemple, mais nous les verrons plus tard.</p>

<p>Disons que nous voulons que le point de départ soit A, sur l'exemple graphique ci-dessus. L'URI de A
 (<var>http://www.xulplanet.com/rdf/A</var>) est la référence du point de départ. Dans un gabarit XUL, vous spécifiez
 le point de départ en utilisant l'attribut <code class="attribut">ref</code>. Voici un exemple&nbsp;:</p>

<pre><code>&lt;vbox datasources="http://www.xulplanet.com/ds/sample.rdf"
      ref="http://www.xulplanet.com/rdf/A" flex="1"&gt;</code></pre>

<p>Il indique que nous désirons construire un gabarit XUL en utilisant le point de référence possédant
 l'URI <var>http://www.xulplanet.com/rdf/A</var>.</p>
