
<p>Le constructeur de contenu des gabarits utilise un composant séparé pour l'insertion des noeuds générés à l'intérieur du contenu des arbres. Il sert pour l'insertion des noeuds qui sont créés initialement ou lorsqu'un résultat devient disponible. Ce composant supplémentaire est appelé le service de tri. Il est chargé de déterminer où les noeuds doivent être insérés dans le document XUL. Comme ce composant est appelé 'service de tri', il sert également à trier les résultats générés. Puisqu'un graphe RDF ne spécifie pas d'ordre pour les résultats -- à moins que les items ne soient dans un Seq RDF -- le constructeur de gabarits traitera les résultats dans n'importe quel ordre. Vous avez dû constater dans les exemples que les résultats qui ne sont pas dans un Seq sont affichés sans ordre particulier.</p>

<p>Le service de tri sert à trier les résultats dans un ordre particulier, généralement croissant ou décroissant en fonction de la valeur d'un prédicat pointant en dehors du noeud résultat. Il supporte également un troisième tri, le tri naturel qui est celui par défaut. Ce dernier fait que les items apparaissent sans ordre déterminé dans l'ordre où ils sont ajoutés. Toutefois, si les résultats sont des items d'un Seq, ils apparaîtront dans le même ordre que dans le Seq. Par exemple, les photos sont listées dans le même ordre dans <a href="exemples/template-guide-ex19.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">cet exemple</a> qu'elles apparaissent dans le Seq de <a href="exemples/template-guide-photos4.rdf">la source de données</a>.</p>

<p>Cette méthode de tri d'un Seq fonctionne bien pour les conditions d'une règle simplifiée puisqu'il est évident que la valeur de départ <code class="attribut">ref</code> fait directement référence à tous les résultats membres (ils sont juste ses fils), ou pour les règles de la syntaxe étendue qui suivent une forme similaire. Pour des règles plus complexes, ce tri naturel ne fonctionnera pas parce que le service de tri suppose que la ressource <code class="attribut">ref</code> de départ est le conteneur et que les résultats finaux sont les fils. Dans ce cas, l'ordre naturel des résultats sera simplement l'ordre dans lequel le constructeur de gabarits va générer les résultats.</p>

<p>Pour les tris par ordre croissant ou décroissant, ce n'est pas important puisqu'ils ignoreront le caractère de conteneurs des résultats et trieront simplement selon une valeur, alphabétiquement ou numériquement en fonction du type des données.</p>

<p>Le service de tri s'applique seulement aux constructeurs de contenu. Les constructeurs d'arbres utilisent une méthode différente et plus simple de tri puisqu'il n'y a pas de contenu à insérer. Ils supportent les même trois types de tri, naturel, croissant ou décroissant. Pour ces deux derniers types de tri, le constructeur d'arbres trie selon la valeur d'une colonne. Par exemple, si les photos étaient affichées dans un arbre à deux colonnes montrant le titre et la description, vous pourriez trier soit par le titre, soit par la description. L'utilisateur peut modifier le tri d'une colonne et sa direction en cliquant sur l'en-tête de la colonne, mais vous pouvez aussi modifier ce tri par la programmation.</p>

<h3>Tri des résultats d'un arbres</h3>

<p>Nous examinerons en premier le tri avec les arbres qui sont les éléments les plus courants utilisant le tri des items. Avec l'utilisation d'un constructeur d'arbres, vous pouvez trier les résultats d'un arbre en colonne. Pour cela, placez un attribut <code class="attribut">sort</code> sur un élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/treecol">treecol</a></code> faisant référence à la variable servant au tri de cette colonne.</p>

<pre><code>&lt;treecol id="name" label="Nom" sort="?name" flex="1"/&gt;
&lt;treecol id="date" label="Date" sort="?date" flex="1"/&gt;</code></pre>

<p>Dans cet exemple, la première colonne sera triée par la variable ?name et la seconde colonne par la variable ?date. Lorsque le tri est croissant, les lignes de l'arbre seront triées par ordre alphabétique. Lorsque le tri est décroissant, les lignes de l'arbre seront triées en sens inverse. Pour l'ordre naturel, les lignes seront triées selon l'ordre naturel de la source de données RDF. Une seule colonne effectue un tri à la fois. Si l'arbre est trié par nom, et que l'utilisateur clique sur l'en-tête de la colonne date, le tri sera modifié et appliqué sur la colonne date.</p>

<p>Il existe deux attributs supplémentaires utilisés pour le tri, et vous permettant de définir le sens du tri initial sur une colonne. Ces attributs sont modifiés quand l'utilisateur change le tri. L'attribut <code class="attribut">sortDirection</code> peut être utilisé pour spécifier le sens du tri initial d'une colonne. Une seule colonne doit avoir cet attribut, car un arbre ne peut être trié que sur une seule colonne à la fois. La valeur peut être soit <var>ascending</var>, <var>descending</var> ou <var>natural</var>. Cette dernière valeur est celle par défaut quand l'attribut n'est pas spécifié. L'attribut <code class="attribut">sortActive</code> peut être défini à <var>true</var> ou <var>false</var> et il spécifie sur quelle colonne de l'arbre s'applique le tri. Une seule colonne ne peut contenir cet attribut <code class="attribut">sortActive</code> défini à <var>true</var>. L'arbre modifiera ces deux attributs automatiquement si nécessaire lorsque les en-têtes de colonnes sont cliqués ou que l'arbre soit trié d'une autre manière.</p>

<p>Si vous ne voulez pas permettre un tri sur certaines colonnes, il vous suffit de ne pas ajouter d'attributs <code class="attribut">sort</code>. Précisez uniquement ces attributs sur les colonnes que vous permettez à l'utilisateur de trier.</p>

<p>Voici <a href="exemples/template-guide-ex41.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">un exemple complet</a> de tri sur un arbre.</p>

<p>L'attribut <code class="attribut">sort</code> doit être défini avec la variable qui contient les valeurs de tri. Habituellement, il s'agit de la même variable qui est utilisée pour générer les libellés des cellules de cette colonne, mais ce n'est pas une obligation. Dans l'exemple, la seconde colonne réalise un tri par date, mais si utilisiez une variable différente telle que ?description, et en supposant qu'un <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/binding">binding</a></code> la définisse, l'arbre pourrait être trié par les valeurs de la variable ?description pour chaque ligne. Dans la plupart des cas toutefois, vous utiliserez la même variable de tri que les valeurs des libellés. Il existe cependant une situation où l'affichage des libellés ne permet pas de générer un tri correct représentatif de leurs valeurs. Par exemple, la date du <var>15 Mai</var> va apparaître après le <var>15 Août</var> avec un tri purement alphabétique, mais elle apparaîtra avant avec un tri chronologique.</p>

<p>Une autre méthode de tri par dates consiste à utiliser la construction avec <var>parseType="Date"</var> dans la source de données. Cette forme marque un littéral comme étant une valeur date plutôt qu'une chaîne de caractères. Le constructeur va le reconnaître et va alors réaliser un tri chronologique. L'avantage est que les dates seront affichées en fonction de la langue de l'utilisateur (ce qui signifie que la date est formatée correctement dans la langue de l'utilisateur). Voici un exemple comment spécifier cette forme dans la source de données RDF/XML&nbsp;:</p>

<pre><code>&lt;rdf:RDF xmlns="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
     xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
     xmlns:r="http://www.xulplanet.com/rdf/"
     xmlns:nc="http://home.netscape.com/NC-rdf#">
  &lt;rdf:Description rdf:about="http://www.xulplanet.com/ndeakin/images/t/palace.jpg"&gt;
    &lt;r:date nc:parseType="Date"&gt;1125966767295&lt;r:date&gt;
  &lt;/rdf:Description&gt;
&lt;/rdf:RDF&gt;</code></pre>

<p>Vous pouvez également spécifier <var>parseType="Integer"</var> pour les nombres afin de permettre un tri numérique. En combinant ces différents types pour différentes valeurs, vous pouvez ainsi trier alphabétiquement, numériquement ou par date.</p>

<p>Si vous utilisez la syntaxe de règles simplifiées, il n'y a pas de variables, donc vous devrez spécifier le prédicat en entier en incluant le préfixe <var>rdf:</var> dans l'attribut <code class="attribut">sort</code>. Par exemple&nbsp;:</p>

<pre><code>&lt;treecol id="name" label="Nom" sort="rdf:http://purl.org/dc/elements/1.1/title" flex="1"/&gt;</code></pre>

<p class="note">Notez que toute cette discussion autour du tri ne s'applique qu'aux constructeurs d'arbres.</p>

<p>Pour les autres éléments ou les arbres à contenu, un mécanisme de tri différent doit être employé et sera discuté par la suite.</p>

<h3>Tri de contenu</h3>

<p>Pour les constructeurs de contenu (les gabarits qui n'utilisent pas flags="dont-build-content"), le tri est effectué de manière différente. Au lieu de trier selon une variable générée pendant la génération du gabarit, le tri pour des constructeurs de contenu ne peut être effectué qu'en utilisant un triplet pointant en dehors de la variable membre. Il n'y a pas de connexion entre les variables générées et la ressource utilisée pour le tri, donc cette ressource n'a pas forcément à être utilisée dans le gabarit.</p>

<p>Vous devez spécifier la ressource utilisée pour le tri avec l'attribut <code class="attribut">sortResource</code> sur l'élément racine, comme ceci&nbsp;:</p>

<pre><code>&lt;hbox datasources="template-guide-photos5.rdf"
      sortResource="http://purl.org/dc/elements/1.1/title"
      sortDirection="ascending"
      ref="http://www.xulplanet.com/rdf/myphotos"&gt;
  &lt;template&gt;
    &lt;vbox class="box-padded" uri="rdf:*"&gt;
      &lt;image src="rdf:*"/&gt;
      &lt;label value="rdf:http://purl.org/dc/elements/1.1/title"/&gt;
    &lt;/vbox&gt;
  &lt;/template&gt;
&lt;/hbox&gt;</code></pre>

<p>Dans <a href="exemples/template-guide-ex42.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">cet exemple</a>, les items générés seront triés par leurs titres. L'attribut <code class="attribut">sortDirection</code> précise la direction du tri et peut être défini à <var>descending</var> pour inverser le tri. L'attribut <code class="attribut">sortDirection</code> fonctionne de manière similaire à celui du constructeur d'arbres. Avec un constructeur d'arbres, chaque colonne dispose de son propre tri grâce à l'attribut <code class="attribut">sort</code>, et l'attribut <code class="attribut">sortActive</code> sert à indiquer la colonne actuellement triée. Pour les autres contenus, il n'y a pas de colonnes et un seul tri est applicable, donc l'attribut <code class="attribut">sortActive</code> n'est pas nécessaire.</p>

<p>Lorsque le constructeur de gabarits génère un résultat, le service de tri utilise la valeur du prédicat <code class="attribut">sortResource</code> afin de déterminer à quel endroit le contenu généré pour l'affichage devra être inséré. Lorsque la source de données RDF change, et qu'un nouveau résultat est disponible, le service de tri insère le nouveau contenu au bon emplacement.</p>

<p>Contrairement aux arbres, vous pouvez réaliser un tri en utilisant une ressource secondaire grâce à l'attribut <code class="attribut">sortResource2</code> qui est utilisé de la même manière que l'attribut <code class="attribut">sortResource</code>. Si les valeurs pour le prédicat de <code class="attribut">sortResource</code> sont les mêmes pour deux résultats, le prédicat de <code class="attribut">sortResource2</code> est utilisé pour clarifier le classement. Vous ne pouvez avoir qu'une ressource secondaire, il n'y a pas d'attribut sortResource3.</p>

<p>Pour modifier le tri du contenu généré par un gabarit, vous pouvez soit modifier les attributs relatifs au tri et reconstruire le gabarit, ou pour les boîtes de liste et les menus, vous pouvez appeler la méthode <code>sort</code> du service de tri&nbsp;:</p>

<pre><code>var listbox = document.getElementById("aListBox");
var sortService = Components.classes["@mozilla.org/xul/xul-sort-service;1"].
                    getService(Components.interfaces.nsIXULSortService);
sortService.sort(listbox, "http://purl.org/dc/elements/1.1/title", "descending");</code></pre>

<p>Ce code va trier un élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/listbox">listbox</a></code> par ordre décroissant de titre. Les arguments de la méthode <code>sort</code> sont le noeud racine (la <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/listbox">listbox</a></code>), la ressource pour le tri et la direction du tri.</p>
