<p>La boîte de liste XUL fournit un certain nombre de méthodes spécialisées.</p>

<h2>Manipulation d'une liste</h2>

<p>L'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/listbox">listbox</a></code>
fournit de nombreuses méthodes pour rechercher et manipuler ses items. Bien que les
boîtes de liste puissent être manipulées en utilisant les fonctions standard de DOM,
il est recommandé d'employer les fonctions spécialisées de <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/listbox">listbox</a></code> autant que possible. Ces fonctions sont plus simples et feront correctement
leur travail.</p>

<p>La fonction <code>appendItem</code> est utilisée pour ajouter un nouvel item à la
fin d'une liste. Elle est similaire à la fonction <code>appendChild</code> de DOM sauf
qu'elle prend un libellé, et que vous n'avez pas à vous soucier où placer votre item
dans la structure de la liste. Voici un exemple&nbsp;:</p>

<p>Exemple 7.3.1&nbsp;:
<a href="exemples/ex_domlists_1.xul.txt">Source</a>
<a href="exemples/ex_domlists_1.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;"
>Voir</a></p>

<pre><code>&lt;script&gt;
function addItem()
{
  document.getElementById('laliste').appendItem("Jeudi", "jeu");
}
&lt;/script&gt;

&lt;listbox id="laliste"/&gt;

&lt;button label="Ajouter" oncommand="addItem();"/&gt;</code></pre>

<p>La fonction <code>appendItem</code> prend deux arguments, le libellé, dans l'exemple <var>Jeudi</var>,
et une valeur <var>jeu</var>. Les deux arguments correspondent aux attributs
<code class="attribut">label</code> et <code class="attribut">value</code> dans
l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/listitem">listitem</a></code>. 
L'attribut <code class="attribut">value</code> est optionnel et sert à affecter à un item une valeur 
que vous pouvez réutiliser ensuite dans un script.</p>

<p>De même, il existe les fonctions <code>insertItemAt</code> et <code>removeItemAt</code>,
qui ajoutent respectivement un nouvel item et suppriment un item existant. La syntaxe est
la suivante&nbsp;:</p>

<pre><code>list.insertItemAt(3, "Jeudi", "jeu");
list.removeItemAt(3);</code></pre>

<p>La fonction <code>insertItemAt</code> prend un argument supplémentaire, la position pour insérer
le nouvel item. Le nouvel item est inséré à cet index. Ainsi, dans l'exemple, le nouvel
item sera ajouté à la position 3 et l'item qui avait cette position aura
maintenant l'index 4. Rappelez-vous que le premier item est 0. La fonction
<code>removeItemAt</code> supprimera l'item à un index spécifique.</p>

<p>Ces trois méthodes sont également disponibles pour plusieurs autres éléments XUL et
fonctionnent de la même manière. En fait, ces méthodes font parties de l'interface
<code><a href="http://www.xulplanet.com/references/xpcomref/ifaces/nsIDOMXULSelectControlElement.html">nsIDOMXULSelectControlElement</a></code> 
donc tous les éléments XUL qui implémentent cette interface
héritent de ces méthodes. Les éléments <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/menulist">menulist</a></code>, <code
class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/radiogroup">radiogroup</a></code>
et <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/tabs">tabs</a></code> en font partie.
Par exemple, pour ajouter un nouvel item à un 
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/menulist">menulist</a></code>, vous pouvez employer
la même syntaxe qu'une <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/listbox">listbox</a></code>. 
Le bon type d'élément sera ajouté dans chaque cas.</p>

<h2>Sélection de liste</h2>

<p>L'interface <code>nsIDOMXULSelectControlElement</code> fournit deux propriétés supplémentaires,
<code>selectedIndex</code> et <code>selectedItem</code>. La première renvoie l'index de l'item
sélectionné tandis que la seconde renvoie l'élément sélectionné. Par exemple, la valeur de retour de
<code>selectedItem</code> sera le <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/menuitem">menuitem</a></code>
sélectionné. Si aucun item n'est sélectionné, <code>selectedIndex</code> retournera <var>-1</var>, et
<code>selectedItem</code> renverra <var>null</var>.</p>

<p>Ces deux propriétés sont généralement inspectées durant un événement de sélection,
comme dans l'exemple suivant&nbsp;:</p>

<p>Exemple 7.3.2&nbsp;:
<a href="exemples/ex_domlists_2.xul.txt">Source</a>
<a href="exemples/ex_domlists_2.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;"
>Voir</a></p>

<pre><code>&lt;listbox id="thelist" onselect="alert(this.selectedItem.label);"&gt;
  &lt;listitem label="Petit"/&gt;
  &lt;listitem label="Moyen"/&gt;
  &lt;listitem label="Grand"/&gt;
&lt;/listbox&gt;</code></pre>

<p>L'événement de sélection est exécuté par une <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/listbox">listbox</a></code> quand un item de
la liste est sélectionné. Le gestionnaire affiche ici une alerte contenant le libellé de
l'item sélectionné dans la liste. Puisque l'événement de sélection s'est exécuté, nous pouvons
supposer qu'un item est sélectionné. Dans d'autres cas, vous devrez vous assurer que
<code>selectedItem</code> n'est pas nul (null) avant de poursuivre.</p>

<p>L'événement de sélection est également exécuté quand un bouton radio dans un <code
class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/radiogroup">radiogroup</a></code>
est sélectionné et quand un onglet est sélectionné dans l'élément <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/tabs">tabs</a></code>. Cependant, les <code
class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/menulists">menulists</a></code>
ne génèrent pas d'événement de sélection&nbsp;; vous pouvez écouter l'événement "command" à la place
pour traiter la sélection d'un item.</p>

<p>Pour l'élément <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/tabs">tabs</a></code>, il est souvent plus
commode d'employer les fonctions de l'élément <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/tabbox">tabbox</a></code>. Il a aussi une
fonction <code>selectedIndex</code> qui renverra l'index de l'onglet sélectionné. Cependant, pour
récupérer l'item sélectionné, utilisez plutôt la fonction <code>selectedTab</code> de
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/tabbox">tabbox</a></code>. 
Ou alors, utilisez la fonction <code>selectedPanel</code> pour récupérer
la page d'onglet sélectionnée, ce qui renvoie le contenu associé à l'onglet.</p>

<p>Toutes les propriétés de sélection décrites ci-dessus peuvent également se voir assigner
une nouvelle valeur pour changer la sélection. Dans l'exemple suivant, la propriété
<code>selectedIndex</code> de l'élément <code class="tag"><a
href="http://xulfr.org/wiki/Reference/Xul/radiogroup">radiogroup</a></code> est changée avec
la valeur entrée dans un champ de saisie. Ce code n'est cependant pas performant&nbsp;; par
exemple, il ne vérifie pas si la valeur entrée est hors limite. Il est conseillé d'ajouter ce genre de vérification d'erreur.</p>

<p>Exemple 7.3.3&nbsp;:
<a href="exemples/ex_domlists_3.xul.txt">Source</a>
<a href="exemples/ex_domlists_3.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a></p>

<pre><code>&lt;script&gt;
function doSelect()
{
  var val = document.getElementById('number').value;
  val = Number(val);
  if (val != null)
    document.getElementById('level').selectedIndex = val - 1;
}
&lt;/script&gt;

&lt;hbox align="center"&gt;
  &lt;label value="Entrez un nombre compris entre 1 et 3 :"/&gt;
  &lt;textbox id="number"/&gt;
  &lt;button label="Sélectionnez" oncommand="doSelect();"/&gt;
&lt;/hbox>

&lt;radiogroup id="level"&gt;
  &lt;radio label="Excellent"/&gt;
  &lt;radio label="Bon"/&gt;
  &lt;radio label="Mauvais"/&gt;
&lt;/radiogroup&gt;</code></pre>

<p>Les boîtes de liste supportent aussi les sélections multiples et les fonctions de l'interface 
<code><a href="http://www.xulplanet.com/references/xpcomref/ifaces/nsIDOMXULMultiSelectControlElement.html">nsIDOMXULMultiSelectControlElement</a></code>. 
Cette interface fournit un certain
nombre de fonctions dédiées pour contrôler la sélection multiple. Par exemple, la propriété
<code>selectedItems</code> contient une liste des items qui sont sélectionnés, alors que la propriété
<code>selectedCount</code> contient le nombre d'items sélectionnés. En général, vous utiliserez
ces propriétés pour parcourir la liste et y effectuer quelques opérations sur chaque item. Faites
attention lorsque vous parcourez les items sélectionnés de la liste&nbsp;; si vous modifiez les items dans
la liste pendant que vous les parcourez, la liste sera modifiée et les propriétés de sélection pourraient
retourner des valeurs différentes. C'est une raison pour laquelle il est utile de manipuler
la liste par item plutôt que par l'index.</p>

<p>L'exemple suivant montre une méthode correcte de suppression des items sélectionnés&nbsp;:</p>

<p>Exemple 7.3.4&nbsp;:
<a href="exemples/ex_domlists_4.xul.txt">Source</a>
<a href="exemples/ex_domlists_4.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a></p>

<pre><code>&lt;script&gt;
function deleteSelection()
{
  var list = document.getElementById('thelist');
  var count = list.selectedCount;
  while (count--){
    var item = list.selectedItems[0];
    list.removeItemAt(list.getIndexOfItem(item));
  }
}
&lt;/script&gt;

&lt;button label="Supprimer" oncommand="deleteSelection();"/&gt;

&lt;listbox id="thelist" seltype="multiple"&gt;
  &lt;listitem label="Cheddar"/&gt;
  &lt;listitem label="Cheshire"/&gt;
  &lt;listitem label="Edam"/&gt;
  &lt;listitem label="Gouda"/&gt;
  &lt;listitem label="Havartie"/&gt;
&lt;/listbox&gt;
</code></pre>

<p>À l'intérieur de la boucle <code>while</code>, nous récupérons d'abord l'item sélectionné à l'index
0. Le premier item sélectionné est toujours recherché car la taille du tableau diminuera
au fur et à mesure que les items seront supprimés. Après, nous supprimons l'item en utilisant la fonction
<code>removeItemAt</code>. Comme cette fonction nécessite un index, nous pouvons faire correspondre un
item et son index en utilisant la fonction <code>getIndexOfItem</code>. La fonction inverse correspondante est
<code>getItemAtIndex</code></p>

<p>L'interface 
<code><a href="http://www.xulplanet.com/references/xpcomref/ifaces/nsIDOMXULMultiSelectControlElement.html">nsIDOMXULMultiSelectControlElement</a></code> 
fournit également des méthodes pour
modifier les items sélectionnés. Par exemple, la fonction <code>addItemToSelection</code> ajoute un
nouvel item à la liste des items sélectionnés, sans vider la sélection existante. La
fonction <code>removeItemFromSelection</code> supprime un seul item dans la sélection.</p>

<h2>Défilement de liste</h2>

<p>Si la boîte de liste contient plus de lignes qu'elle ne peut en afficher, une barre de
défilement apparaîtra pour permettre à l'utilisateur de faire défiler la liste. La
position du défilement peut être ajustée en utilisant quelques méthodes de
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/listbox">listbox</a></code>.</p>

<p>La méthode <code>scrollToIndex</code> fait défiler jusqu'à une ligne donnée. Cette boîte de liste
défilera jusqu'à ce que la ligne soit la première ligne visible, à moins que la ligne
ne soit proche de la fin de la liste des items. La méthode <code>ensureIndexIsVisible</code> est
similaire puisqu'elle fait défiler la liste pour afficher une ligne, mais cette méthode ne
défilera pas si l'item est déjà visible. Ainsi, la première fonction est utilisée pour
faire défiler jusqu'à une ligne précise alors que la deuxième est utilisée pour s'assurer que
la ligne soit visible. Il y a également <code>ensureItemIsVisible</code> qui nécessite un item en argument
au lieu d'un index. Comparez l'effet de ces deux fonctions à des positions de défilement
différentes dans cet exemple&nbsp;:</p>

<p>Exemple 7.3.5&nbsp;:
<a href="exemples/ex_domlists_5.xul.txt">Source</a>
<a href="exemples/ex_domlists_5.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a></p>

<pre><code>&lt;button label="scrollToIndex"
           oncommand="document.getElementById('thelist').scrollToIndex(4);"/&gt;
&lt;button label="ensureIndexIsVisible"
           oncommand="document.getElementById('thelist').ensureIndexIsVisible(4);"/&gt;

&lt;listbox id="thelist" rows="5"&gt;
  &lt;listitem label="1"/&gt;
  &lt;listitem label="2"/&gt;
  &lt;listitem label="3"/&gt;
  &lt;listitem label="4"/&gt;
  &lt;listitem label="5"/&gt;
  &lt;listitem label="6"/&gt;
  &lt;listitem label="7"/&gt;
  &lt;listitem label="8"/&gt;
  &lt;listitem label="9"/&gt;
  &lt;listitem label="10"/&gt;
  &lt;listitem label="11"/&gt;
  &lt;listitem label="12"/&gt;
&lt;/listbox&gt;
</code></pre>
<hr />

<p>Nous verrons ensuite les objets boîtes XUL.</p>

