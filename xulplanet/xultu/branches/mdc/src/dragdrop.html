<p class="note">Attention, cette page est maintenue dans la version française, 
mais elle a été enlevée par son auteur sur la version anglaise.</p>

<p>
Cette section indique comment implémenter des objets capables d'être déplacés et lâchés sur
d'autres objets.
</p>

<h2>L'interface glisser-déposer</h2>

<p>
De nombreuses interfaces graphiques permettent de glisser-déposer des objets. Il est par
exemple possible de déplacer des fichiers d'un dossier à l'autre, ou de lâcher une icône sur
une fenêtre pour ouvrir le document qui lui correspond. Mozilla et XUL fournissent une panoplie
d'événements qui se déclenchent lorsque un utilisateur essaie de déplacer un objet.
</p>

<p>
L'utilisateur commence le glissement en cliquant et en déplaçant la souris sans relâcher le
bouton. Le glissement finit quand l'utilisateur relâche le bouton. Des gestionnaires d'événements
sont appelés dans ces deux situations, ainsi que lors de certaines étapes intermédiaires.
</p>

<p>
Mozilla implémente le glisser-déposer à l'aide d'une «&nbsp;session de glisser-déposer&nbsp;». Quand un
utilisateur demande à faire glisser un objet, et que celui-ci est susceptible d'être glissé-déposé,
une session est initiée. La session se charge de modifier le curseur de la souris là où l'objet
peut être déposé. Si l'objet ne supporte pas le glisser-déposer, la session n'est pas créée.
L'utilisateur n'ayant en général qu'une souris, une seule session est active à un instant donné.
</p>

<p class="note">
Notez que la session peut être créée depuis Mozilla, mais aussi par d'autres applications. Le
cas échéant, Mozilla s'occupe de traduire la session.
</p>

<p>
La liste qui suit décrit tous les gestionnaires d'événements pouvant être appelés, et que
n'importe quel élément peut implémenter. Vous n'avez à définir que les événements qui vous
intéressent.
</p>

<dl>
  <dt><code class="attribut">ondraggesture</code></dt>
  <dd>Appelé quand l'utilisateur commence à glisser l'élément, ce qui arrive quand l'utilisateur
  garde le bouton de la souris appuyé et la déplace. Le script qui intercepte cet événement doit mettre
  en place une session de glisser-déposer.</dd>
  <dt><code class="attribut">ondragover</code></dt>
      <dd>Appelé pour un élément survolé par le glisser. Si l'objet peut être lâché ici, vous le
      signalez à la session.</dd>
  <dt><code class="attribut">ondragenter</code></dt>
      <dd>Appelé quand le glisser entre dans l'«&nbsp;espace aérien&nbsp;» de l'élément. Il permet à l'élément
      de changer d'apparence pour signifier à l'utilisateur qu'il peut lâcher ici.</dd>
  <dt><code class="attribut">ondragexit</code></dt>
      <dd>Appelé quand le glisser cesse de survoler l'élément, et également quand le glisser-déposer
      s'achève. Il permet ainsi de rétablir l'apparence de l'élément ou de faire d'autres choses.
      </dd>
  <dt><code class="attribut">ondragdrop</code></dt>
     <dd> Appelé quand le glisser-déposer s'achève sur l'élément. À ce moment-là, l'utilisateur a déjà
     relâché le bouton de la souris. L'élément peut choisir d'ignorer
      l'événement, ou réagir en insérant l'objet glissé par exemple.
      </dd>
</dl>

<p>
Il y a deux façons de gérer les événements de glisser-déposer. La première passe par l'emploi
direct des interfaces de glisser-déposer XPCOM. La seconde est de passer par un conteneur javascript
qui vous décharge d'une partie du travail. Ce conteneur est inclus dans le paquet "toolkit" ou "global"
de Mozilla.
</p>

<h2>Le glisser-déposer avec XPCOM</h2>

<p>
Deux interfaces sont utilisées pour le glisser-déposer. La première est un service de glisser-déposer,
<code>nsIDragService</code>, et la seconde est la session, <code>nsIDragSession</code>.
</p>

<p>
<code>nsIDragService</code> est responsable de la création de session quand le glissement commence, et de sa
destruction quand le glissement s'achève. Sa fonction <code>invokeDragSession</code> doit être appelée
pour commencer le glisser-déposer, dans le contexte d'un événement
<code class="attribut">ondraggesture</code>. Une fois cette fonction appelée, le
glisser-déposer a commencé.
</p>

<p>
La fonction <code>invokeDragSession</code> prend quatre paramètres, décrits ci-après&nbsp;:
</p>

<pre><code>invokeDragSession(element,transferableArray,region,actions);</code></pre>

<dl>
  <dt><code>element</code></dt>
     <dd>Une référence à l'élément à glisser-déposer. On l'obtient en accédant à la propriété
      <code>event.target</code> dans le gestionnaire d'événement.</dd>
  <dt><code>transferableArray</code></dt>
      <dd>Un tableau d'objets <code>nsITransferable</code>, un par élément glissé-déposé. On utilise un tableau
      pour pouvoir déplacer plusieurs éléments d'un coup, un ensemble de fichiers par exemple.</dd>
  <dt><code>region</code></dt>
      <dd>Une région utilisée pour donner un retour à l'utilisateur. Mettre à <var>null</var> dans la
      majorité des cas.</dd>
  <dt><code>actions</code></dt>
     <dd>Les actions utilisées par le glisser-déposer. Elles peuvent prendre l'une
     des valeurs de constantes suivantes, ou une combinaison de ces valeurs.
     L'action peut être changée pendant le glisser-déposer selon l'élément qui est survolé&nbsp;:
      <dl>
        <dt><code>nsIDragSession.DRAGDROP_ACTION_NONE</code></dt>
            <dd>Indique qu'aucune action de glisser-déposer n'est valide.</dd>
        <dt><code>nsIDragSession.DRAGDROP_ACTION_COPY</code></dt>
            <dd>L'élément glissé-déposé peut être copié lors du lâcher.</dd>
        <dt><code>nsIDragSession.DRAGDROP_ACTION_MOVE</code></dt>
            <dd>L'élément peut être déplacé lors du lâcher.</dd>
        <dt><code>nsIDragSession.DRAGDROP_ACTION_LINK</code></dt>
           <dd>Un lien (raccourci ou alias) peut être créé là où a lieu le lâcher.</dd>
     </dl></dd>
</dl>

<p>
L'interface <code>nsIDragService</code> fournit également la fonction <code>getCurrentSession</code> qui peut
être appelée dans le contexte d'un des événements de glisser-déposer pour accéder à, et modifier,
l'état du glisser-déposer. Cette fonction renvoie un objet implémentant <code>nsIDragSession</code>.
</p>

<p>
L'interface <code>nsIDragSession</code> sert à modifier les propriétés du glisser-déposer en cours.
Elle exploite les propriétés et méthodes suivantes&nbsp;:
</p>

<dl>
  <dt><code>canDrop</code></dt>
      <dd>Affectez <var>true</var> à cette propriété si l'élément en dessous du curseur pourrait accepter
      que l'élément glissé soit déposé, et <var>false</var> si ce n'est pas envisageable. Modifiez
      cette valeur dans le contexte d'événements <code>ondragover</code> et <code>ondragenter</code>.</dd>
  <dt><code>dragAction</code></dt>
      <dd>Détermine l'action à entreprendre au lâcher, sous forme d'une combinaison des constantes
      décrites plus haut. Permet de fournir un meilleur retour à l'utilisateur.</dd>
  <dt><code>numDropItems</code></dt>
      <dd>Le nombre d'objets déplacés. Par exemple, si l'on déplace cinq marque-pages, ce sera <var>5</var>.</dd>
  <dt><code>getData (transfer,index)</code></dt>
      <dd>Obtenir des objets déplacés. Le premier argument est un objet <code>nsITransferable</code> qui recevra
      la réponse, le second est l'indice de l'élément à retourner.</dd>
  <dt><code>sourceDocument</code></dt>
      <dd>Le document où le glisser-déposer a commencé.</dd>
  <dt><code>sourceNode</code></dt>
      <dd>Le n½ud DOM où le glisser-déposer a commencé.</dd>
  <dt><code>isDataFlavorSupported(flavour)</code></dt>
      <dd>Renvoie <var>true</var> si la donnée déplacée contient un exemplaire dans le type (flavour) indiqué.</dd>
</dl>

<hr />

<p>Dans la prochaine section, nous verrons comment utiliser le conteneur Javascript pour le
glisser-déposer.</p>


