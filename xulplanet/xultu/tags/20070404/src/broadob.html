
<p>Parfois, vous voulez que plusieurs éléments répondent à des événements ou changent
d'état aisément. Pour cela, nous pouvons utiliser les «&nbsp;broadcasters&nbsp;» (diffuseurs).</p>

<h2>Commandes de transmission d'attributs</h2>

<p>Nous avons vu précédemment que les éléments tels que les boutons peuvent être ancrés à des commandes.
De plus, si vous placez l'attribut <code class="attribut">disabled</code> sur l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/command">command</a></code>,
tous les éléments ancrés sur celui-ci seront eux aussi désactivés automatiquement. C'est
une façon utile de diminuer la taille du code nécessaire. Cette technique fonctionne
aussi pour les autres attributs. Par exemple, si vous placez un attribut
<code class="attribut">label</code> sur un élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/command">command</a></code>, chaque
bouton attaché à la commande partagera ce libellé.</p>

<p>Exemple 6.7.1&nbsp;:
<a href="exemples/ex_broadob_1.xul.txt">Source</a>
<a href="exemples/ex_broadob_1.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a></p>

<pre><code>&lt;command id="ma_commande" label="Ouvrir"/&gt;

&lt;button command="ma_commande"/&gt;
&lt;checkbox label="Ouvrir une nouvelle fenêtre" command="ma_commande"/&gt;</code></pre>

<p>Dans cet exemple, le bouton n'a pas d'attribut <code class="attribut">label</code>, néanmoins
il est attaché à une commande qui en possède un. Le bouton va donc le partager avec la commande.
La case à cocher a déjà un libellé, néanmoins, il va être surchargé par celui de la commande.
Le résultat est que le bouton et la case à cocher auront le même libellé <var>Ouvrir</var>.</p>

<p>Si vous modifiez l'attribut <code class="attribut">label</code> de la commande,
les libellés du bouton et de la case à cocher changeront eux aussi. Nous avons vu une application similaire dans une section précédente où l'attribut <code class="attribut">disabled</code> était
défini puis propagé aux autres éléments.</p>

<p>Cette transmission d'attribut est relativement utile pour plusieurs raisons. Par exemple, disons
que nous voulons désactiver l'action «&nbsp;Page précédente&nbsp;» dans un navigateur. Nous aurions
besoin de désactiver cette action dans le menu, dans la barre des tâches, le raccourci clavier
(<kbd>Alt</kbd>+<kbd>Gauche</kbd> par ex.) et chaque commande «&nbsp;Page précédente&nbsp;» des menus déroulants. Écrire un script pour le faire n'est pas très simple. Le
désavantage est de devoir prévoir tous les endroits où pourraient se trouver les boutons «&nbsp;Page précédente&nbsp;».
Si quelqu'un a ajouté un nouveau bouton «&nbsp;Page précédente&nbsp;» en utilisant une extension, il ne serait
pas pris en compte. Il est plus pratique de désactiver simplement l'action «&nbsp;Page précédente&nbsp;» et que tous
les éléments utilisant cette action se désactivent eux-mêmes. Nous pouvons utiliser la transmission
d'attributs des commandes pour accomplir cela.</p>

<h2>Broadcasters</h2>

<p>Il y existe un élément similaire appelé <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/broadcaster">broadcaster</a></code>.
Les broadcasters supportent la transmission d'attributs de la même manière que les commandes.
Ils fonctionnent de la même manière excepté le fait qu'une commande est utilisée pour les actions,
alors qu'un broadcaster est utilisé pour contenir l'information d'un état. Par exemple, un
élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/command">command</a></code>
serait utilisé pour une action comme «&nbsp;Page précédente&nbsp;», «&nbsp;Couper&nbsp;» ou «&nbsp;Supprimer&nbsp;». Un
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/broadcaster">broadcaster</a></code>
serait utilisé pour contenir, par exemple, un drapeau indiquant si l'utilisateur est en ligne ou non.
Dans le premier cas, les éléments du menu et de la barre des tâches nécessiteraient d'être désactivés
lorsqu'il n'y a pas de page de retour, ou aucun texte à couper, à effacer. Dans le second cas,
plusieurs éléments de l'interface auraient besoin d'être mis à jour lorsque l'utilisateur passerait du mode en
ligne au mode hors ligne.</p>

<p>Le broadcaster le plus simple est défini ci-dessous. Vous devriez toujours utiliser un attribut
<code class="attribut">id</code> afin qu'il puisse être référencé à partir d'autres éléments.</p>

<pre><code>&lt;broadcasterset&gt;
  &lt;broadcaster id="isOffline" label="Hors ligne"/&gt;
&lt;/broadcasterset&gt;</code></pre>

<p>Tous les éléments qui «&nbsp;observent&nbsp;» le broadcaster seront modifiés automatiquement chaque fois
que l'attribut <code class="attribut">label</code> du broadcaster change.
Ces éléments auront comme résultat un nouveau libellé.
Tout comme d'autres éléments non affichés, l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/broadcasterset">broadcasterset</a></code>
est un conteneur pour les broadcasters. Vous devez déclarer tous vos broadcasters dans un élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/broadcasterset">broadcasterset</a></code>
afin de les réunir.</p>

<h2>Création d'éléments observateurs</h2>

<p>Les éléments qui observent le broadcaster sont appelés observateurs car ils «&nbsp;observent&nbsp;» l'état du
broadcaster. Pour qu'un élément devienne un observateur, ajoutez lui un attribut
<code class="attribut">observes</code>. Il est analogue à l'attribut
<code class="attribut">command</code> utilisé pour attacher un élément à un élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/command">command</a></code>.
Par exemple, pour qu'un bouton devienne un observateur du broadcaster décrit ci-dessus&nbsp;:</p>

<pre><code>&lt;button id="offline_button" observes="isOffline"/&gt;</code></pre>

<p>L'attribut <code class="attribut">observes</code> a été placé sur le bouton et sa valeur a
été affectée à la valeur de l'<code class="attribut">id</code> du broadcaster à observer.
Ici, le bouton va observer le broadcaster avec l'id <var>isOffline</var>
qui a été défini un peu plus haut dans le code. Si la valeur de l'attribut
<code class="attribut">label</code> du broadcaster change, les observateurs mettront
à jour leur valeur de l'attribut <code class="attribut">label</code>.</p>

<p>Nous pourrions continuer avec d'autres éléments. Autant d'éléments que vous voulez
peuvent observer le même broadcaster. Vous pouvez aussi n'avoir qu'un seul élément observateur, mais cela
ne servirait pas à grand chose puisque la raison principale d'utiliser les broadcasters est
d'avoir des attributs transmis à de multiples endroits. Vous ne devriez utiliser les
broadcasters que lorsque vous avez besoin que plusieurs éléments aient à observer un attribut.
D'autres observateurs sont décrits ci-dessous&nbsp;:</p>

<pre><code>&lt;broadcaster id="offline_command" label="Hors ligne" accesskey="f"/&gt;

&lt;keyset&gt;
  &lt;key id="goonline_key" observes="offline_command" modifiers="accel" key="O"/&gt;
&lt;keyset&gt;
&lt;menuitem id="offline_menuitem" observes="offline_command"/&gt;
&lt;toolbarbutton id="offline_toolbarbutton" observes="offline_command"/&gt;</code></pre>

<p>Dans cet exemple, <code class="attribut">label</code> et l'<code class="attribut">accesskey</code>
seront transmis par le broadcaster au raccourci clavier, à l'item de menu et au bouton de la barre d'outils.
Le raccourci clavier n'utilisera aucun des attributs reçus, mais il sera désactivé lorsque le broadcaster le sera.</p>

<p>Vous pouvez utiliser un broadcaster pour observer n'importe quel attribut désiré. Les
observateurs récupèreront les valeurs de chaque attribut, via les broadcasters, dès qu'ils changeront. Si jamais la valeur d'un seul attribut change, les observateurs seront
avisés et ajusteront leurs propres attributs en conséquence. Les attributs des observateurs
que le broadcaster ne possède pas lui-même ne sont pas modifiés. Les seuls attributs qui ne sont
pas modifiés sont les attributs <code class="attribut">id</code> et <code class="attribut">persist</code>&nbsp;;
ces attributs ne sont jamais partagés. Vous pouvez également utiliser vos propres attributs si vous le désirez.</p>

<p>Les broadcasters ne sont pas fréquemment utilisés, car les commandes peuvent en général
convenir à la majorité des usages. Une chose à préciser est qu'il n'y a pas vraiment de
différence entre l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/command">command</a></code>
et l'élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/broadcaster">broadcaster</a></code>.
Ils font tous les deux la même chose. La différence est plutôt sémantique. Utilisez les commandes
pour les actions et utilisez les broadcasters pour les états.
En fait, chaque élément peut agir comme un broadcaster, tant que vous l'observez en utilisant
l'attribut <code class="attribut">observes</code>.</p>

<h2>L'élément Observes</h2>

<p>Il existe un moyen de spécifier plus précisemment les attributs du broadcaster à observer. Cela
implique un élément <code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/observes">observes</a></code>.
Tout comme son attribut l'indique, il vous permet d'indiquer à un élément qu'il est un observateur.
L'élément <code class="tag">observes</code> doit être placé en tant qu'enfant de l'élément qui doit être
l'observateur.
Voici un exemple&nbsp;:</p>

<p>Exemple 6.7.2&nbsp;:
<a href="exemples/ex_broadob_2.xul.txt">Source</a>
<a href="exemples/ex_broadob_2.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a></p>

<pre><code>&lt;broadcasterset&gt;
  &lt;broadcaster id="isOffline" label="Hors ligne" accesskey="f"/&gt;
&lt;/broadcasterset&gt;

&lt;button id="offline_button"&gt;
  &lt;observes element="isOffline" attribute="label"/&gt;
&lt;/button&gt;</code></pre>

<p>Deux attributs ont été ajoutés à l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/observes">observes</a></code>.
Le premier, <code class="attribut">element</code>, spécifie l'identifiant du broadcaster à observer.
Le second, <code class="attribut">attribute</code>, spécifie l'attribut à observer.
Le résultat est que le bouton recevra son libellé du broadcaster, et quand l'attribut <code class="attribut">label</code>
sera modifié, le libellé du bouton sera changé. L'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/observes">observes</a></code>
ne change pas, contrairement à l'élément qui le contient, qui est dans ce cas un
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/button">button</a></code>.
Notez que l'attribut <code class="attribut">accesskey</code> n'est pas transmis au bouton,
puisque il n'est pas observé. Si vous voulez que ce soit le cas, un autre élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/observes">observes</a></code>
devra être ajouté. Si vous n'utilisez aucun élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/observes">observes</a></code>,
et qu'à la place vous utilisez l'attribut <code class="attribut">observes</code> directement
sur le bouton, tous les attributs seront observés.</p>

<h3>Événement broadcast</h3>

<p>Il existe un gestionnaire d'événements supplémentaire, <code class="attribut">onbroadcast</code>,
que nous pouvons placer sur l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/observes">observes</a></code>.
L'événement est appelé dès que l'observateur
détecte un changement dans l'attribut du broadcaster qu'il observe. Un exemple est décrit
ci-dessous&nbsp;:</p>

<p>Exemple 6.7.3&nbsp;:
<a href="exemples/ex_broadob_3.xul.txt">Source</a>
<a href="exemples/ex_broadob_3.xul" onclick="window.open(this.href,'xulex','chrome,resizable'); return false;">Voir</a></p>

<pre><code>&lt;broadcasterset&gt;
  &lt;broadcaster id="colorChanger" style="color: black"/&gt;
&lt;/broadcasterset&gt;

&lt;button label="Test"&gt;
  &lt;observes element="colorChanger" attribute="style" onbroadcast="alert('La couleur a changé');"/&gt;
&lt;/button&gt;

&lt;button label="Observateur"
  oncommand="document.getElementById('colorChanger').setAttribute('style','color: red');"
/&gt;</code></pre>

<p>Deux boutons ont été créés, un nommé <var>Test</var> et l'autre <var>Observateur</var>. Si vous cliquez sur
le bouton «&nbsp;Test&nbsp;», rien ne se produit. En revanche, si vous cliquez sur le bouton «&nbsp;Observateur&nbsp;»,
deux choses surviennent. Premièrement, le texte du bouton devient rouge, deuxièmement, un
message d'alerte apparaît avec le message <var>La couleur a changé</var>.</p>

<p>Voilà ce qui se passe&nbsp;: le gestionnaire <code class="attribut">oncommand</code> du second
bouton est appelé lorsque l'utilisateur appuie dessus. Le script dispose ici d'une référence au
broadcaster et change le style de celui-ci afin qu'il ait une couleur (<code>color</code>)
rouge. Le broadcaster n'est pas affecté par le changement de style car il n'est pas affiché à
l'écran. Néanmoins, le premier bouton a un observateur qui tient compte du changement de style.
Les attributs <code class="attribut">element</code> et <code class="attribut">attribute</code> sur la balise
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/observes">observes</a></code>
détecte le changement de style. Le style est appliqué automatiquement au premier bouton.</p>

<p>Ensuite, puisque la transmission se fait, le gestionnaire d'événement <code class="attribut">onbroadcast</code>
est appelé. Il en résulte l'affichage d'un message d'alerte. Notez que la transmission ne se fait que
si les attributs de l'élément
<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/broadcaster">broadcaster</a></code> sont modifiés.
Changer le style du bouton directement ne déclenchera aucune diffusion d'événement et le message d'alerte ne s'affichera pas.</p>

<p>Si vous essayez de dupliquer le code du premier bouton
(<code class="tag"><a href="http://xulfr.org/wiki/Reference/Xul/button">button</a></code>)
plusieurs fois, vous verrez une série de messages d'alerte, un pour chaque bouton, car
chaque bouton est un observateur et sera prévenu du changement de style.</p>

<hr />

<p>Nous verrons dans la section suivante l'utilisation du Modèle Objet de Document (<acronym title="Document Object Model">DOM</acronym>)
avec les éléments XUL.</p>
